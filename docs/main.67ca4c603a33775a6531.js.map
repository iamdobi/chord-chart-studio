{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/app/plugins/content/header/header.hbs","webpack:///./src/renderer/bar/barSeparator.hbs","webpack:///./src/app/plugins/editor/editor.hbs","webpack:///./src/renderer/chord/chordSymbol.hbs","webpack:///./src/renderer/chord/chordLine.hbs","webpack:///./src/renderer/bar/barContent.hbs","webpack:///./src/app/core/plugin.js","webpack:///./src/core/dom/htmlToElement.js","webpack:///./src/app/plugins/content/header/plugin.js","webpack:///./src/app/plugins/content/footer/plugin.js","webpack:///./src/editor/prosemirror/plugins/onStateChange.js","webpack:///./src/editor/prosemirror/schema.js","webpack:///./src/editor/prosemirror/helpers/stateToArray.js","webpack:///./src/editor/prosemirror/editor.js","webpack:///./src/editor/prosemirror/getPlugins.js","webpack:///./src/isChord.js","webpack:///./src/isChordLine.js","webpack:///./src/isTimeSignatureString.js","webpack:///./src/parseTimeSignature.js","webpack:///./src/parseChord.js","webpack:///./src/exceptions/IncorrectBeatCountException.js","webpack:///./src/exceptions/InvalidChordRepetitionException.js","webpack:///./src/parseChordLine.js","webpack:///./src/renderer/helper/songs.js","webpack:///./src/parseSong.js","webpack:///./src/getAllChordsInSong.js","webpack:///./src/spacer/chord/simple.js","webpack:///./src/spacer/chord/aligned.js","webpack:///./src/renderer/transposeChord.js","webpack:///./src/renderer/transposeSong.js","webpack:///./src/renderer/getMainAccidental.js","webpack:///./src/renderer/isRenderer.js","webpack:///./src/renderer/bar/barContent.js","webpack:///./src/renderer/chord/chordLine.js","webpack:///./src/renderer/chord/chordSymbol.js","webpack:///./src/renderer/text/textLine.js","webpack:///./src/getChordSymbol.js","webpack:///./src/renderer/song/song.js","webpack:///./src/getMaxBeatsWidth.js","webpack:///./src/app/plugins/editor/plugin.js","webpack:///./src/app/core/store.js","webpack:///./src/app/plugins/fileExplorer/fileManager.js","webpack:///./src/app/plugins/fileExplorer/plugin.js","webpack:///./src/app/plugins/renderingOptions/plugin.js","webpack:///./src/app/main.js","webpack:///./src/app/core/app.js","webpack:///./src/app/core/areaBroker.js","webpack:///./src/app/registerPlugins.js","webpack:///./src/renderer/song/song.hbs","webpack:///./src/renderer/text/textLine.hbs","webpack:///./src/app/plugins/renderingOptions/renderingOptions.hbs","webpack:///./src/app/plugins/content/footer/footer.hbs","webpack:///./src/app/plugins/fileExplorer/entry.hbs","webpack:///./src/app/plugins/fileExplorer/fileExplorer.hbs"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","Handlebars","template","compiler","main","container","depth0","helpers","partials","useData","escapeExpression","lambda","chordSymbol","stack1","chordLine","barContent","pluginFactory","pluginDef","plugin","EventEmitter","host","assign","getHost","Error","setHost","newHost","htmlToElement","html","document","createElement","trim","innerHTML","content","firstChild","headerPlugin","render","headerArea","this","getAreaBroker","getHeader","header","headerTpl","appendChild","footerPlugin","footerArea","getFooter","footer","footerTpl","onStateChangeFactory","editor","pmPlugin","view","update","editorView","emit","state","editorSchema","Schema","nodes","marks","stateToArray","toJSON","doc","map","paragraph","reduce","acc","current","text","editorFactory","renderTo","EventEmitter2","editorPlugins","pmHistory","keymap","Mod-z","undo","Mod-y","redo","baseKeymap","onStateChange","getPlugins","on","load","newContent","newState","EditorState","pmDOMParser","fromSchema","parse","plugins","updateState","EditorView","getContent","chords","Chords","isChordLine","line","replace","split","potentialChord","every","_","isString","isChord","allowedTimeSignatures","isTimeSignatureString","string","includes","parseTimeSignature","TypeError","array","count","Number","parseInt","beatCount","IncorrectBeatCountException","constructor","duration","currentBeatCount","isFinite","super","InvalidChordRepetitionException","parseChordLine","timeSignature","allLineChords","allBars","bar","allChords","chord","model","chordCount","previousChord","forEach","chordString","parseChord","match","beat","isEqual","cloneDeep","message","forEachChordInSong","allLines","fn","newLines","type","defaultTimeSignature","parseSong","song","isArray","isTimeSignature","e","findIndex","occurrences","getAllChordsInSong","allMasks","","2","11","3","12","21","111","4","13","22","31","112","121","211","1111","spacesAfterDefault","emptyBeatSpaces","notes","sharpsToFlats","C#","D#","F#","G#","A#","flatsToSharps","invert","convertToSharp","note","transposeNote","useFlats","transposedIndex","indexOf","octaves","Math","floor","transposed","transposeSong","transposeValue","accidentalsType","harmonizeAccidentals","accidental","rootNote","flatCount","sharpCount","symbol","getMainAccidental","transposedModel","transposedChord","root","bass","bassNote","rootSharp","bassSharp","transposeChord","isRenderer","renderer","isObject","isFunction","renderer_bar_barContent","chordRenderer","spacesWithin","spacesAfter","rendering","repeat","barContentTpl","renderer_chord_chordLine","chordLineModel","barContentRenderer","allBarsRendered","barSeparator","barSeparatorTpl","join","chordLineTpl","renderer_chord_chordSymbol","chordSymbolTpl","renderer_text_textLine","textLine","textLineTpl","getChordSymbol","chordDef","print","renderer_song_song","songTxt","alignBars","parsedSong","maxBeatsWidth","filter","barIndex","max","getMaxBeatsWidth","spaced","chordLineInput","beatMaxWidth","alignedChordSpacer","chordPattern","chordSpaces","toString","simpleChordSpacer","rendered","chordLineRenderer","chordSymbolRenderer","textLineRenderer","songTpl","editorPlugin","app","contentArea","editorDom","editorTpl","renderingOptions","querySelector","previewContainer","previewSong","songLines","songRenderer","childNodes","replaceChild","newOptions","file","div","toNode","store","localStorage","getItem","setItem","JSON","stringify","getOneByKey","getAllByKeyPrefix","keyPrefix","allEntries","delete","removeItem","fileExplorerFactory","fileManager","newFile","nanoid","title","getAll","updateContent","updateTitle","deleteOne","fileExplorerPlugin","sideBar","getSideBar","fileExplorer","DocumentFragment","activeFileKey","fileExplorerTpl","newFileBtn","deleteFileBtn","fileList","insertFile","newEntry","fileEntryTpl","activeFile","nextSibling","insertBefore","activateFile","querySelectorAll","active","classList","remove","add","fm","allFiles","sortedFiles","sortBy","makeTitleEditable","entry","contentEditable","focus","range","Range","selectNodeContents","selection","getSelection","removeAllRanges","addRange","addEventListener","editable","isSameNode","target","newFileElement","defer","toDelete","toActivate","previousSibling","removeChild","dataset","which","preventDefault","stopPropagation","blur","throttle","keyElement","closest","innerText","detail","parentElement","fileContent","init","fileManagerFactory","renderingOptionsPlugin","renderingOptionsTpl","checked","transposeDown","transposeUp","transpose","step","newTransposeValue","areaBroker","pluginRegistry","async","pluginRun","method","registerPlugin","appFactory","areas","getterName","cssSelector","areaId","charAt","toUpperCase","area","item","areaBrokerFactory","then","helper","alias1","nullContext","alias2","helperMissing","alias4","hash"],"mappings":"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","file":"main.67ca4c603a33775a6531.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"NjgO\",1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var Handlebars = require(\"../../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"app-header\\\">\\n    <div class=\\\"h2-like\\\">Chord+</div>\\n    <div>Universal chord charts</div>\\n</div>\\n\";\n},\"useData\":true});","var Handlebars = require(\"../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<span class=\\\"cp2-bar-separator\\\">|</span>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"editor-area\\\">\\n    <section class=\\\"left\\\">\\n        <div id=\\\"source\\\"></div>\\n    </section>\\n\\n    <section class=\\\"right\\\">\\n        <div id=\\\"preview\\\"><div></div></div>\\n    </section>\\n</div>\";\n},\"useData\":true});","var Handlebars = require(\"../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<span class=\\\"cp2-chord-symbol\\\">\"\n    + container.escapeExpression(container.lambda((depth0 != null ? depth0.chordSymbol : depth0), depth0))\n    + \"</span>\";\n},\"useData\":true});","var Handlebars = require(\"../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<p class=\\\"cp2-chord-line\\\">\"\n    + ((stack1 = container.lambda((depth0 != null ? depth0.chordLine : depth0), depth0)) != null ? stack1 : \"\")\n    + \"</p>\";\n},\"useData\":true});","var Handlebars = require(\"../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<span class=\\\"cp2-bar-content\\\">\"\n    + ((stack1 = container.lambda((depth0 != null ? depth0.barContent : depth0), depth0)) != null ? stack1 : \"\")\n    + \"</span>\";\n},\"useData\":true});","import EventEmitter from 'eventemitter2';\n\nexport default function pluginFactory(pluginDef) {\n\tconst plugin = new EventEmitter();\n\n\tlet host;\n\n\treturn Object.assign(plugin, pluginDef, {\n\t\tgetHost() {\n\t\t\tif (!host) {\n\t\t\t\tthrow new Error('Plugin\\'s host has not been setup, cannot retrieve it');\n\t\t\t}\n\t\t\treturn host;\n\t\t},\n\n\t\tsetHost(newHost) {\n\t\t\tif (host) {\n\t\t\t\tthrow new Error('Cannot override Plugin\\'s host');\n\t\t\t}\n\t\t\thost = newHost;\n\t\t}\n\t});\n}","// https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro\nexport default function htmlToElement(html) {\n\tconst template = document.createElement('template');\n\thtml = html.trim();\n\ttemplate.innerHTML = html;\n\treturn template.content.firstChild;\n}","import pluginFactory from '../../../core/plugin';\nimport htmlToElement from '../../../../core/dom/htmlToElement';\n\nimport headerTpl from './header.hbs';\n\nconst headerPlugin = pluginFactory({\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst headerArea = areaBroker.getHeader();\n\n\t\tconst header = htmlToElement(headerTpl());\n\n\t\theaderArea.appendChild(header);\n\t}\n});\n\nexport default headerPlugin;","import pluginFactory from '../../../core/plugin';\nimport htmlToElement from '../../../../core/dom/htmlToElement';\n\nimport footerTpl from './footer.hbs';\n\nconst footerPlugin = pluginFactory({\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst footerArea = areaBroker.getFooter();\n\n\t\tconst footer = htmlToElement(footerTpl());\n\n\t\tfooterArea.appendChild(footer);\n\t}\n});\n\nexport default footerPlugin;","import { Plugin as pmPlugin } from 'prosemirror-state';\n\nexport default function onStateChangeFactory(editor) {\n\treturn new pmPlugin({\n\t\tkey: 'onStateChange',\n\t\tview: () => {\n\t\t\treturn {\n\t\t\t\tupdate(editorView) {\n\t\t\t\t\teditor.emit('statechange', editorView.state);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t});\n}\n","import { Schema } from 'prosemirror-model';\nimport { nodes, marks } from 'prosemirror-schema-basic';\n\nconst editorSchema = new Schema({\n\tnodes: nodes,\n\tmarks: marks\n});\n\nexport default editorSchema;","/**\n * Convert a prosemirror state to an array of lines, with only text and no formatting\n */\nexport default function stateToArray(state) {\n\tconst json = state.toJSON();\n\n\treturn json.doc.content.map(paragraph => {\n\t\tif (!paragraph.content) {\n\t\t\treturn '';\n\t\t}\n\t\treturn paragraph.content.reduce((acc, current) => {\n\t\t\tacc += current.text;\n\t\t\treturn acc;\n\t\t}, '');\n\t});\n}","import { EditorState } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport { DOMParser as pmDOMParser } from 'prosemirror-model';\nimport getPlugins from './getPlugins';\nimport editorSchema from './schema';\n\nimport stateToArray from './helpers/stateToArray';\n\nimport { EventEmitter2 } from 'eventemitter2';\n\nimport 'prosemirror-view/style/prosemirror.css';\n\n\n/**\n * @param {Node} renderTo\n */\nexport default function editorFactory(renderTo) {\n\n\tconst editor = new EventEmitter2();\n\tconst editorPlugins = getPlugins(editor);\n\n\tlet editorView;\n\n\teditor.on('statechange', state => {\n\t\teditor.emit('change', stateToArray(state));\n\t});\n\n\treturn Object.assign(editor, {\n\t\tload(newContent) {\n\t\t\tconst newState = EditorState.create({\n\t\t\t\tdoc: pmDOMParser.fromSchema(editorSchema).parse(newContent),\n\t\t\t\tplugins: editorPlugins\n\t\t\t});\n\n\t\t\tif (editorView) {\n\t\t\t\teditorView.updateState(newState);\n\n\t\t\t} else {\n\t\t\t\teditorView = new EditorView(renderTo, { state: newState });\n\t\t\t}\n\t\t\teditor.emit('statechange', newState);\n\t\t},\n\n\t\tgetContent() {\n\t\t\treturn stateToArray(editorView.state);\n\t\t}\n\t});\n}\n","import { keymap } from 'prosemirror-keymap';\nimport { baseKeymap } from 'prosemirror-commands';\nimport { undo, redo, history as pmHistory } from 'prosemirror-history';\nimport onStateChange from './plugins/onStateChange';\n\nexport default function getPlugins(editor) {\n\treturn [\n\t\tpmHistory(),\n\t\tkeymap({ 'Mod-z': undo, 'Mod-y': redo }),\n\t\tkeymap(baseKeymap),\n\t\tonStateChange(editor)\n\t];\n}\n","import _ from 'lodash';\n\nimport { Chords } from 'momo-chords';\n\nconst chords = new Chords();\n\nexport default function isChord(potentialChord) {\n\treturn _.isString(potentialChord) && chords.isChord(potentialChord);\n}","import isChord from './isChord';\n\nexport default function isChordLine(line = '') {\n\treturn line\n\t\t.replace(/\\t+/g, ' ')\n\t\t.replace(/  +/g, ' ')\n\t\t.trim()\n\t\t.split(' ')\n\t\t.map(potentialChord => potentialChord.replace(/\\.*$/g, ''))\n\t\t.every(potentialChord => isChord(potentialChord));\n}\n","const allowedTimeSignatures = [\n\t'2/2', '3/2',\n\t'3/4', '4/4', '5/4',\n\t'3/8', '6/8', '9/8', '12/8'\n];\n\nexport default function isTimeSignatureString(string) {\n\treturn allowedTimeSignatures.includes(string);\n}","import isTimeSignatureString from './isTimeSignatureString';\n\n/**\n * @typedef {Object} TimeSignature\n * @type {Object}\n * @property {String} string - original string\n * @property {Number} count - upper part of time signature\n * @property {Number} value - lower part of time signature\n * @property {Number} beatCount - number of beats per bar\n */\n\n/**\n * @param {String} string\n * @returns {TimeSignature}\n */\nexport default function parseTimeSignature(string) {\n\tif (!isTimeSignatureString(string)) {\n\t\tthrow new TypeError('Expected time signature string, received: ' + string);\n\t}\n\n\tconst array = string.split('/');\n\n\tconst count = Number.parseInt(array[0], 10);\n\tconst value = Number.parseInt(array[1], 10);\n\n\tlet beatCount = count;\n\n\tif (value === 2) {\n\t\tbeatCount = count * 2;\n\n\t} else if (value === 8) {\n\t\tbeatCount = count / 3;\n\t}\n\n\treturn {\n\t\tstring,\n\t\tcount,\n\t\tvalue,\n\t\tbeatCount,\n\t};\n}\n\n","import { Chords } from 'momo-chords';\n\nconst chords = new Chords();\n\n/**\n * @see https://github.com/mdanka/momo-chords/blob/master/src/types.ts\n */\n\n/**\n * @typedef {Object} ChordDef\n * @type {Object}\n * @property {ChordSymbol} symbol\n * @property {Object} structure - whether each degree (1, 2, 3... 11) is present (true/false) in the chord\n */\n\n/**\n * @typedef {Object} ChordSymbol\n * @type {Object}\n * @property {String} rootNote\n * @property {String} [bassNote]\n * @property {String} quality\n * @property {Object} addeds\n * @property {Object} suspended\n * @property {String} [alteredFifth]\n * @property {String} [seventh]\n * @property {String} [ninth]\n * @property {String} [eleventh]\n * @property {String} [thirteenth]\n */\n\n/**\n * @param chordString\n * @returns {ChordDef}\n */\nexport default function parseChord(chordString) {\n\treturn chords.parse(chordString);\n}\n","import _ from 'lodash';\n\nexport default class IncorrectBeatCountException extends Error {\n\tconstructor(\n\t\t{\n\t\t\tstring,\n\t\t\tduration,\n\t\t\tcurrentBeatCount,\n\t\t\tbeatCount\n\t\t} = {}\n\t) {\n\t\tif (!string || !_.isString(string)) {\n\t\t\tthrow new TypeError('IncorrectBeatCountException cannot be created without chord string, received: ' + string);\n\t\t}\n\t\tif (!duration || !_.isFinite(duration)) {\n\t\t\tthrow new TypeError('IncorrectBeatCountException cannot be created without chord duration, received: ' + duration);\n\t\t}\n\t\tif (!currentBeatCount || !_.isFinite(currentBeatCount)) {\n\t\t\tthrow new TypeError('IncorrectBeatCountException cannot be created without currentBeatCount, received: ' + currentBeatCount);\n\t\t}\n\t\tif (!beatCount || !_.isFinite(beatCount)) {\n\t\t\tthrow new TypeError('IncorrectBeatCountException cannot be created without beatCount, received: ' + beatCount);\n\t\t}\n\n\t\tsuper();\n\n\t\tthis.name = 'IncorrectBeatCountException';\n\t\tthis.string = string;\n\t\tthis.duration = duration;\n\t\tthis.currentBeatCount = currentBeatCount;\n\t\tthis.beatCount = beatCount;\n\t}\n}\n\n","import _ from 'lodash';\n\nexport default class InvalidChordRepetitionException extends Error {\n\tconstructor(\n\t\t{\n\t\t\tstring,\n\t\t} = {}\n\t) {\n\t\tif (!string || !_.isString(string)) {\n\t\t\tthrow new TypeError('InvalidChordRepetitionException cannot be created without chord string, received: ' + string);\n\t\t}\n\n\t\tsuper();\n\n\t\tthis.name = 'InvalidChordRepetitionException';\n\t\tthis.string = string;\n\t}\n}\n\n","import _ from 'lodash';\n\nimport parseChord from './parseChord';\nimport parseTimeSignature from './parseTimeSignature';\n\nimport IncorrectBeatCountException from './exceptions/IncorrectBeatCountException';\nimport InvalidChordRepetitionException from './exceptions/InvalidChordRepetitionException';\n\n/**\n * @typedef {Object} ChordLine\n * @type {Object}\n * @property {Number} chordCount - number of chords in the line\n * @property {Bar[]} allBars\n */\n\n/**\n * @typedef {Object} Bar\n * @type {Object}\n * @property {TimeSignature} timeSignature\n * @property {ChordLineChord[]} allChords\n */\n\n/**\n * @typedef {Object} ChordLineChord\n * @type {Object}\n * @property {String} string - original chord string\n * @property {ChordDef} model\n * @property {Number} duration - number of beats the chord lasts\n * @property {Number} beat - beat on which the chord starts\n */\n\n/**\n * @param {String} chordLine\n * @param {TimeSignature} timeSignature\n * @returns {ChordLine}\n */\nexport default function parseChordLine(\n\tchordLine,\n\t{\n\t\ttimeSignature = parseTimeSignature('4/4')\n\t} = {}\n) {\n\tconst { beatCount } = timeSignature;\n\n\tconst allLineChords = chordLine\n\t\t.replace(/  +/g, ' ')\n\t\t.trim()\n\t\t.split(' ');\n\tconst allBars = [];\n\n\tlet bar = { allChords: []};\n\tlet chord = {};\n\tlet model = {};\n\tlet currentBeatCount = 0;\n\tlet chordCount = 0;\n\tlet previousChord = {};\n\n\tallLineChords.forEach(chordString => {\n\t\tmodel = parseChord(chordString.replace(/\\./g, ''));\n\t\tchord = {\n\t\t\tstring: chordString,\n\t\t\tduration: ((chordString.match(/\\./g) || []).length) || beatCount,\n\t\t\tmodel,\n\t\t};\n\t\tchord.beat = currentBeatCount + 1;\n\t\tcurrentBeatCount += chord.duration;\n\n\t\tif (bar.allChords.length > 0) {\n\t\t\tpreviousChord = bar.allChords[bar.allChords.length - 1];\n\t\t\tif (_.isEqual(previousChord.model, chord.model)) {\n\t\t\t\tthrow new InvalidChordRepetitionException({\n\t\t\t\t\tstring: chord.string,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tbar.allChords.push(chord);\n\t\tchordCount++;\n\n\t\tif (currentBeatCount === beatCount) {\n\t\t\tbar.timeSignature = timeSignature;\n\n\t\t\tallBars.push(_.cloneDeep(bar));\n\n\t\t\tbar = { allChords: []};\n\t\t\tcurrentBeatCount = 0;\n\t\t\tpreviousChord = {};\n\n\t\t} else if (currentBeatCount > beatCount) {\n\t\t\tthrow new IncorrectBeatCountException({\n\t\t\t\tmessage: '',\n\t\t\t\tstring: chord.string,\n\t\t\t\tduration: chord.duration,\n\t\t\t\tcurrentBeatCount,\n\t\t\t\tbeatCount,\n\t\t\t});\n\t\t}\n\t});\n\n\tif (currentBeatCount > 0 && (currentBeatCount < beatCount)) {\n\t\tthrow new IncorrectBeatCountException({\n\t\t\tmessage: '',\n\t\t\tstring: chord.string,\n\t\t\tduration: chord.duration,\n\t\t\tcurrentBeatCount,\n\t\t\tbeatCount,\n\t\t});\n\t}\n\n\treturn {\n\t\tchordCount,\n\t\tallBars\n\t};\n}\n","import _ from 'lodash';\n\n/**\n * @param {SongLine[]} allLines\n * @param {Function} fn - to execute on each chord\n * @returns {SongLine[]}\n */\nexport function forEachChordInSong(allLines, fn) {\n\tconst newLines = _.cloneDeep(allLines);\n\n\tnewLines.forEach(line => {\n\t\tif (line.type === 'chord') {\n\t\t\tline.model.allBars.forEach(bar => {\n\t\t\t\tbar.allChords.forEach(chord => {\n\t\t\t\t\tfn(chord);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\treturn newLines;\n}\n\n/**\n * @param {ChordLine[]} chordLine\n * @param {Function} fn - to execute on each chord\n * @returns {ChordLine[]}\n */\nexport function forEachChordInChordLine(chordLine, fn) {\n\tconst newChordLine = _.cloneDeep(chordLine);\n\n\tnewChordLine.allBars.forEach(bar => {\n\t\tbar.allChords.forEach(chord => {\n\t\t\tfn(chord);\n\t\t});\n\t});\n\n\treturn newChordLine;\n}\n","import _ from 'lodash';\n\nimport isChordLine from './isChordLine';\nimport isTimeSignature from './isTimeSignatureString';\n\nimport parseTimeSignature from './parseTimeSignature';\nimport parseChordLine from './parseChordLine';\n\nimport getAllChordsInSong from './getAllChordsInSong';\n\n/**\n * @typedef {Object} SongLine\n * @type {Object}\n * @property {String} string - original line in source file\n * @property {String} type - chord|text|time-signature|...\n * @property {ChordLine|TimeSignature} model\n */\n\n/**\n * @typedef {Object} Song\n * @type {Object}\n * @property {SongLine[]} allLines\n * @property {SongChord[]} allChords\n */\n\n/**\n * @typedef {Object} SongChord\n * @type {Object}\n * @property {ChordDef} model\n * @property {number} occurrences - number of times the chord appears in the song\n */\n\n/**\n * @type {string}\n */\nconst defaultTimeSignature = '4/4';\n\n/**\n * @param {string|array} song\n * @returns {Song}\n */\nexport default function parseSong(song) {\n\n\tlet timeSignature = parseTimeSignature(defaultTimeSignature);\n\n\tconst songLines = (!_.isArray(song)) ? song.split('\\n') : song;\n\n\tconst allLines = songLines\n\t\t.map(string => ({ string }))\n\t\t.map(line => {\n\t\t\tif (isTimeSignature(line.string)) {\n\t\t\t\ttimeSignature = parseTimeSignature(line.string);\n\n\t\t\t\tline.type = 'time-signature';\n\t\t\t\tline.model = timeSignature;\n\n\t\t\t} else if (isChordLine(line.string)) {\n\t\t\t\ttry {\n\t\t\t\t\tline.type = 'chord';\n\t\t\t\t\tline.model = parseChordLine(line.string, { timeSignature });\n\n\t\t\t\t} catch (e) {\n\t\t\t\t\tline.type = 'text';\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tline.type = 'text';\n\t\t\t}\n\t\t\treturn line;\n\t\t});\n\n\n\tconst allChords = getAllChordsInSong(allLines);\n\n\treturn {\n\t\tallLines,\n\t\tallChords\n\t};\n}\n","import _ from 'lodash';\n\nimport { forEachChordInSong } from './renderer/helper/songs';\n\n/**\n * @param {SongLine[]} allLines\n * @returns {SongChord[]}\n */\nexport default function getAllChordsInSong(allLines) {\n\tconst allChords = [];\n\tlet i;\n\n\tforEachChordInSong(allLines, chord => {\n\t\ti = _.findIndex(allChords, o => _.isEqual(o.model, chord.model));\n\n\t\tif (i === -1) {\n\t\t\tallChords.push({\n\t\t\t\tmodel: _.cloneDeep(chord.model),\n\t\t\t\toccurrences: 1\n\t\t\t});\n\t\t} else {\n\t\t\tallChords[i].occurrences++;\n\t\t}\n\t});\n\n\treturn allChords;\n}\n","import _ from 'lodash';\n\nconst allMasks = {\n\t0: {\n\t\t'': []\n\t},\n\n\t2: {\n\t\t'2': \t[3], \t\t// 'A   '\n\t\t'11':  \t[3, 2], \t// 'A   B  ',\n\t},\n\n\t3: {\n\t\t'3': \t[3], \t\t// 'A   '\n\t\t'12':  \t[2, 4], \t// 'A  B    '\n\t\t'21': \t[6, 0], \t// 'A      C'\n\t\t'111': \t[2, 2, 0], \t// 'A  B  C'\n\t},\n\n\t4: {\n\t\t'4': \t[3], \t\t// 'A   ',\n\t\t'13': \t[1, 4], \t// 'A B    ',\n\t\t'22': \t[3, 2], \t// 'A   B  ',\n\t\t'31':   [5, 0], \t// 'A     B',\n\t\t'112':  [1, 1, 3], \t// 'A B C   ',\n\t\t'121':  [1, 4, 0], \t// 'A B    C',\n\t\t'211': \t[4, 1, 0], \t// 'A    B C',\n\t\t'1111': [2, 2, 2], \t// 'A  B  C  D',\n\t},\n};\n\nexport default function space(chordLineInput) {\n\tconst chordLine = _.cloneDeep(chordLineInput);\n\n\tlet beatCount = 0;\n\tlet chordPattern = '';\n\tlet chordSpaces = [];\n\n\tchordLine.allBars.forEach(bar => {\n\t\tbeatCount = 0;\n\t\tchordPattern = '';\n\n\t\tbar.allChords.forEach(chord => {\n\t\t\tchordPattern += chord.duration.toString();\n\t\t\tbeatCount += chord.duration;\n\t\t});\n\n\t\tchordSpaces = allMasks[beatCount][chordPattern];\n\n\t\tfor (let i = 0; i < chordPattern.length; i++) {\n\t\t\tbar.allChords[i].spacesAfter = chordSpaces[i];\n\t\t}\n\t});\n\n\treturn chordLine;\n}\n","import _ from 'lodash';\n\nconst spacesAfterDefault = 2;\nconst emptyBeatSpaces = 1;\n\nexport default function space(chordLineInput, maxBeatsWidth) {\n\tconst chordLine = _.cloneDeep(chordLineInput);\n\n\tlet beatMaxWidth;\n\n\tchordLine.allBars.forEach((bar, barIndex) => {\n\t\tbar.allChords.forEach(chord => {\n\t\t\tchord.spacesWithin = maxBeatsWidth[barIndex][chord.beat] - chord.symbol.length;\n\t\t\tchord.spacesAfter = 0;\n\n\t\t\tif (chord.beat !== bar.timeSignature.beatCount) {\n\t\t\t\tchord.spacesAfter = spacesAfterDefault;\n\n\t\t\t\tfor (let i = (chord.beat + 1); i < (chord.beat + chord.duration); i++) {\n\t\t\t\t\tbeatMaxWidth = maxBeatsWidth[barIndex][i];\n\n\t\t\t\t\tchord.spacesAfter += (beatMaxWidth)\n\t\t\t\t\t\t? beatMaxWidth\n\t\t\t\t\t\t: emptyBeatSpaces;\n\n\t\t\t\t\tif (i !== bar.timeSignature.beatCount && beatMaxWidth) {\n\t\t\t\t\t\tchord.spacesAfter += spacesAfterDefault;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\treturn chordLine;\n}","import _ from 'lodash';\n\nconst notes = [\n\t'C',\n\t'C#',\n\t'D',\n\t'D#',\n\t'E',\n\t'F',\n\t'F#',\n\t'G',\n\t'G#',\n\t'A',\n\t'A#',\n\t'B',\n];\n\nconst sharpsToFlats = {\n\t'C#': 'Db',\n\t'D#': 'Eb',\n\t'F#': 'Gb',\n\t'G#': 'Ab',\n\t'A#': 'Bb',\n};\n\nconst flatsToSharps = _.invert(sharpsToFlats);\n\nfunction convertToSharp(note) {\n\treturn flatsToSharps[note] || note;\n}\n\nfunction transposeNote(note, value, useFlats) {\n\tconst noteIndex = notes.indexOf(note);\n\tconst transposedIndex = noteIndex + value;\n\n\tconst octaves = Math.floor(transposedIndex / 12);\n\tconst correctedTransposedIndex = transposedIndex - (octaves * 12);\n\n\tconst transposed = notes[correctedTransposedIndex];\n\n\treturn (useFlats)\n\t\t? sharpsToFlats[transposed] || transposed\n\t\t: transposed;\n}\n\nexport default function transposeChord(chord, value, useFlats) {\n\tconst transposedChord = _.cloneDeep(chord); // check immutability\n\n\tconst root = transposedChord.symbol.rootNote;\n\tconst bass = transposedChord.symbol.bassNote;\n\n\tconst rootSharp = convertToSharp(root);\n\ttransposedChord.symbol.rootNote = transposeNote(rootSharp, value, useFlats);\n\n\tif (bass) {\n\t\tconst bassSharp = convertToSharp(bass);\n\t\ttransposedChord.symbol.bassNote = transposeNote(bassSharp, value, useFlats);\n\t}\n\n\treturn transposedChord;\n}","import _ from 'lodash';\nimport transposeChord from './transposeChord';\nimport getMainAccidental from './getMainAccidental';\n\nimport { forEachChordInSong } from './helper/songs';\n\n/**\n * @param {SongLine[]} allLines\n * @param {SongChord[]} allChords\n * @param transposeValue\n * @param accidentalsType\n * @param harmonizeAccidentals\n * @returns {SongLine[]} - with added transposedModel property on each chord if needed\n */\nexport default function transposeSong(allLines, allChords, {\n\ttransposeValue = 0,\n\taccidentalsType = 'auto',\n\tharmonizeAccidentals = true\n} = {}) {\n\tlet transposed = _.cloneDeep(allLines);\n\n\tlet accidental = (accidentalsType === 'auto')\n\t\t? getMainAccidental(allChords)\n\t\t: accidentalsType;\n\n\tif (harmonizeAccidentals || transposeValue !== 0) {\n\t\ttransposed = forEachChordInSong(transposed, (chord) => {\n\t\t\tchord.transposedModel = transposeChord(\n\t\t\t\tchord.model,\n\t\t\t\ttransposeValue,\n\t\t\t\taccidental === 'flat'\n\t\t\t);\n\t\t});\n\t}\n\n\treturn transposed;\n}\n","/**\n * Returns the most used accidental of a song.\n *\n * @param {SongChord[]} allChords\n * @returns {('flat'|'sharp')}\n */\nexport default function getMainAccidental(allChords) {\n\tlet rootNote = '';\n\tlet flatCount = 0;\n\tlet sharpCount = 0;\n\n\tallChords.forEach(chord => {\n\t\trootNote = chord.model.symbol.rootNote;\n\n\t\tif (rootNote.length === 2) {\n\t\t\tlet accidental = rootNote[1];\n\n\t\t\tif (accidental === 'b') {\n\t\t\t\tflatCount += chord.occurrences;\n\t\t\t} else {\n\t\t\t\tsharpCount += chord.occurrences;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn (flatCount > sharpCount) ? 'flat' : 'sharp';\n}\n","import _ from 'lodash';\n\nexport default function isRenderer(renderer) {\n\treturn (_.isObject(renderer) && _.isFunction(renderer.render));\n}","import _ from 'lodash';\n\nimport isRenderer from '../isRenderer';\n\nimport barContentTpl from './barContent.hbs';\n\nconst space = ' ';\n\nconst defaultSpacesWithin = 0;\nconst defaultSpacesAfter = 2;\n\nexport default {\n\trender(bar, { chordRenderer } = {}) {\n\t\tlet spacesWithin = 0;\n\t\tlet spacesAfter = 0;\n\n\t\tif (! isRenderer(chordRenderer)) {\n\t\t\tthrow new TypeError('chordRenderer is not a valid renderer');\n\t\t}\n\n\t\tconst barContent = bar.allChords.reduce((rendering, chord) => {\n\t\t\tspacesWithin = _.isFinite(chord.spacesWithin) ? chord.spacesWithin : defaultSpacesWithin;\n\t\t\tspacesAfter = _.isFinite(chord.spacesAfter) ? chord.spacesAfter : defaultSpacesAfter;\n\n\t\t\trendering +=\n\t\t\t\tchordRenderer.render(chord.symbol) +\n\t\t\t\tspace.repeat(spacesWithin) +\n\t\t\t\tspace.repeat(spacesAfter);\n\n\t\t\treturn rendering;\n\t\t}, '');\n\n\t\treturn barContentTpl({ barContent });\n\t}\n};\n","import chordLineTpl from './chordLine.hbs';\nimport barSeparatorTpl from '../bar/barSeparator.hbs';\nimport isRenderer from '../isRenderer';\n\nexport default {\n\trender(chordLineModel, {\n\t\tbarContentRenderer,\n\t\tchordRenderer\n\t} = {}) {\n\n\t\tif (! isRenderer(barContentRenderer)) {\n\t\t\tthrow new TypeError('barContentRenderer is not a valid renderer');\n\t\t}\n\n\t\tconst allBarsRendered = chordLineModel.allBars\n\t\t\t.map(bar => barContentRenderer.render(bar, { chordRenderer }));\n\n\t\tconst barSeparator = barSeparatorTpl();\n\n\t\tconst chordLine = barSeparator +\n\t\t\tallBarsRendered.join(barSeparator) +\n\t\t\tbarSeparator;\n\n\t\treturn chordLineTpl({ chordLine });\n\t}\n};","import chordSymbolTpl from './chordSymbol.hbs';\n\nexport default {\n\trender(chordSymbol) {\n\t\treturn chordSymbolTpl({ chordSymbol });\n\t}\n};","import textLineTpl from './textLine.hbs';\n\nexport default {\n\trender(textLine) {\n\t\treturn textLineTpl({ textLine });\n\t}\n};","import { Chords } from 'momo-chords';\n\nconst chords = new Chords();\n\n/**\n * @param {ChordDef} chordDef\n * @returns {string}\n */\nexport default function(chordDef) {\n\treturn chords.print(chordDef.symbol);\n}","import parseSong from '../../parseSong';\n\nimport getMaxBeatsWidth from '../../getMaxBeatsWidth';\n\nimport simpleChordSpacer from '../../spacer/chord/simple';\nimport alignedChordSpacer from '../../spacer/chord/aligned';\n\nimport transposeSong from '../transposeSong';\nimport { forEachChordInSong } from '../helper/songs';\n\nimport barContentRenderer from '../bar/barContent';\nimport chordLineRenderer from '../chord/chordLine';\nimport chordSymbolRenderer from '../chord/chordSymbol';\nimport textLineRenderer from '../text/textLine';\n\nimport songTpl from './song.hbs';\nimport getChordSymbol from '../../getChordSymbol';\n\n\nexport default {\n\trender(songTxt, {\n\t\talignBars = false,\n\t\ttransposeValue = 0,\n\t\taccidentalsType = 'auto',\n\t\tharmonizeAccidentals = true\n\t}) {\n\t\tconst parsedSong = parseSong(songTxt);\n\t\tlet { allLines, allChords } = parsedSong;\n\n\t\tallLines = transposeSong(allLines, allChords,  {\n\t\t\ttransposeValue,\n\t\t\taccidentalsType,\n\t\t\tharmonizeAccidentals\n\t\t});\n\t\tallLines = forEachChordInSong(allLines, (chord) => {\n\t\t\tchord.symbol = (chord.transposedModel)\n\t\t\t\t? getChordSymbol(chord.transposedModel)\n\t\t\t\t: getChordSymbol(chord.model);\n\t\t});\n\n\t\tconst maxBeatsWidth = getMaxBeatsWidth(allLines);\n\n\t\tconst song = allLines\n\t\t\t.map(line => {\n\n\t\t\t\tif (line.type === 'chord') {\n\t\t\t\t\tconst spaced = (alignBars)\n\t\t\t\t\t\t? alignedChordSpacer(line.model, maxBeatsWidth)\n\t\t\t\t\t\t: simpleChordSpacer(line.model);\n\n\t\t\t\t\tline.rendered = chordLineRenderer.render(spaced, {\n\t\t\t\t\t\tbarContentRenderer: barContentRenderer,\n\t\t\t\t\t\tchordRenderer: chordSymbolRenderer,\n\t\t\t\t\t});\n\n\t\t\t\t} else if (line.type === 'text') {\n\t\t\t\t\tline.rendered = textLineRenderer.render(line.string);\n\t\t\t\t}\n\t\t\t\treturn line;\n\t\t\t})\n\t\t\t.filter(line => line.rendered)\n\t\t\t.map(line => line.rendered)\n\t\t\t.join('\\n');\n\n\t\treturn songTpl({ song });\n\t}\n};\n","/**\n * @param {SongLine[]} allLines\n * @returns {Array}\n */\nexport default function getMaxBeatsWidth(allLines) {\n\tconst maxBeatsWidth = [];\n\n\tallLines\n\t\t.filter(line => line.type === 'chord')\n\t\t.forEach(line => {\n\t\t\tline.model.allBars.forEach((bar, barIndex) => {\n\t\t\t\tif (!maxBeatsWidth[barIndex]) {\n\t\t\t\t\tmaxBeatsWidth[barIndex] = {};\n\n\t\t\t\t\tfor (let i = 1; i <= bar.timeSignature.beatCount; i++) {\n\t\t\t\t\t\tmaxBeatsWidth[barIndex][i] = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbar.allChords.forEach(chord => {\n\t\t\t\t\tmaxBeatsWidth[barIndex][chord.beat] = Math.max(\n\t\t\t\t\t\tmaxBeatsWidth[barIndex][chord.beat],\n\t\t\t\t\t\tchord.symbol.length\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\treturn maxBeatsWidth;\n}\n","import _ from 'lodash';\n\nimport pluginFactory from '../../core/plugin';\nimport htmlToElement from '../../../core/dom/htmlToElement';\n\nimport editorFactory from '../../../editor/prosemirror/editor';\nimport songRenderer from '../../../renderer/song/song';\n\nimport editorTpl from './editor.hbs';\n\nconst editorPlugin = pluginFactory({\n\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst contentArea = areaBroker.getContent();\n\n\t\tconst editorDom = htmlToElement(editorTpl());\n\n\t\tcontentArea.appendChild(editorDom);\n\n\n\t\tconst renderingOptions = {\n\t\t\talignBars: true,\n\t\t\ttransposeValue: 0\n\t\t};\n\n\n\t\t// add editor functionality\n\t\tconst editorNode = document.querySelector('#source');\n\n\t\tconst editor = editorFactory(editorNode);\n\n\n\t\tconst previewContainer = document.querySelector('#preview');\n\n\t\tfunction previewSong(songLines) {\n\t\t\tconst renderedSong = songRenderer.render(songLines, renderingOptions);\n\t\t\tconst rendered = htmlToElement(renderedSong);\n\n\t\t\tif (previewContainer.childNodes.length) {\n\t\t\t\tpreviewContainer.replaceChild(rendered, previewContainer.firstChild);\n\t\t\t} else {\n\t\t\t\tpreviewContainer.appendChild(rendered);\n\t\t\t}\n\t\t}\n\n\t\tfunction refreshPreview() {\n\t\t\tconst songLines = editor.getContent();\n\t\t\tpreviewSong(songLines);\n\t\t}\n\n\t\teditor.on('change', (songLines) => {\n\t\t\tpreviewSong(songLines, renderingOptions);\n\t\t\tapp.emit('editorchange', songLines.join('\\n'));\n\t\t});\n\n\t\tapp.on('optionchange', newOptions => {\n\t\t\t_.assign(renderingOptions, newOptions);\n\t\t\trefreshPreview();\n\t\t});\n\n\t\tfunction toNode(text) {\n\t\t\tconst div = document.createElement('div');\n\t\t\tdiv.innerHTML = text\n\t\t\t\t.split('\\n')\n\t\t\t\t.map(line => `<p>${line}</p>`)\n\t\t\t\t.join('');\n\t\t\treturn div;\n\t\t}\n\n\t\t// listen to events\n\t\tapp.on('activatefile', file => editor.load(toNode(file.content)));\n\n\n\t}\n});\n\nexport default editorPlugin;","/**\n * Local storage wrapper\n * For now, the only accepted values are objects that are automatically serialized\n */\nconst store = {\n\tcreate(key, value) {\n\t\tif (localStorage.getItem(key)) {\n\t\t\tthrow new Error('Already exists key: ' + key);\n\t\t}\n\t\tif (!key) {\n\t\t\tthrow new Error('Cannot create localstorage entry with empty key');\n\t\t}\n\t\tlocalStorage.setItem(key, JSON.stringify(value));\n\t},\n\n\tgetOneByKey(key) {\n\t\tconst value = localStorage.getItem(key);\n\t\treturn (value) ? JSON.parse(value) : value;\n\t},\n\n\tgetAllByKeyPrefix(keyPrefix) {\n\t\tconst allEntries = {};\n\n\t\tlet key;\n\n\t\tfor (let i = 0; i < localStorage.length; i++) {\n\t\t\tkey = localStorage.key(i);\n\t\t\tif (key.indexOf(keyPrefix) === 0) {\n\t\t\t\tallEntries[key] = this.getOneByKey(key);\n\t\t\t}\n\t\t}\n\n\t\treturn allEntries;\n\t},\n\n\tupdate(key, value) {\n\t\tif (!localStorage.getItem(key)) {\n\t\t\tthrow new Error('Cannot find and update key: ' + key);\n\t\t}\n\t\tlocalStorage.setItem(key, JSON.stringify(value));\n\t},\n\n\tdelete(key) {\n\t\tlocalStorage.removeItem(key);\n\t}\n};\n\nexport default store;","import nanoid from 'nanoid';\nimport EventEmitter from 'eventemitter2';\n\nimport store from '../../core/store';\n\nconst keyPrefix = 'song:';\n\nfunction fileFactory() {\n\treturn {\n\t\tkey: keyPrefix + nanoid(20),\n\t\ttitle: 'untitled', //todo: translate!\n\t\tcontent: ''\n\t};\n}\n\nexport default function fileExplorerFactory() {\n\tconst fileManager = new EventEmitter();\n\n\treturn Object.assign(fileManager, {\n\t\tcreate() {\n\t\t\tconst newFile = fileFactory();\n\n\t\t\tstore.create(newFile.key, newFile);\n\n\t\t\treturn newFile;\n\t\t},\n\n\t\tgetAll() {\n\t\t\treturn store.getAllByKeyPrefix(keyPrefix);\n\t\t},\n\n\t\tgetOneByKey(key) {\n\t\t\treturn store.getOneByKey(key);\n\t\t},\n\n\t\tupdateContent(key, content) {\n\t\t\tconst file = store.getOneByKey(key);\n\t\t\tfile.content = content;\n\n\t\t\tstore.update(key, file);\n\t\t},\n\n\t\tupdateTitle(key, title) {\n\t\t\tconst file = store.getOneByKey(key);\n\t\t\tfile.title = title;\n\n\t\t\tstore.update(key, file);\n\t\t},\n\n\t\tdeleteOne(key) {\n\t\t\tstore.delete(key);\n\t\t}\n\t});\n}","import _ from 'lodash';\n\nimport pluginFactory from '../../../app/core/plugin';\nimport htmlToElement from '../../../core/dom/htmlToElement';\n\nimport fileManagerFactory from './fileManager';\n\nimport fileExplorerTpl from './fileExplorer.hbs';\nimport fileEntryTpl from './entry.hbs';\n\n\nconst autosaveIntervalMs = 1000;\n\nconst fileExplorerPlugin = pluginFactory({\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst sideBar = areaBroker.getSideBar();\n\n\t\tconst fileExplorer = new DocumentFragment();\n\t\tfileExplorer.appendChild(htmlToElement(fileExplorerTpl()));\n\n\n\t\tlet activeFileKey;\n\n\t\t// DOM elements\n\t\tconst newFileBtn = fileExplorer.querySelector('[data-action=\"new-file\"]');\n\t\tconst deleteFileBtn = fileExplorer.querySelector('[data-action=\"delete-file\"]');\n\t\tconst fileList = fileExplorer.querySelector('.entry-list');\n\n\n\t\tfunction insertFile(file) {\n\t\t\tconst newEntry = htmlToElement(fileEntryTpl(file));\n\n\t\t\tconst activeFile = fileList.querySelector(`[data-key=\"${activeFileKey}\"`);\n\n\t\t\tif (activeFile && activeFile.nextSibling) {\n\t\t\t\tfileList.insertBefore(newEntry, activeFile.nextSibling);\n\n\t\t\t} else {\n\t\t\t\tfileList.appendChild(newEntry);\n\t\t\t}\n\t\t\treturn newEntry;\n\t\t}\n\n\t\tconst activateFile = (key) => {\n\t\t\tactiveFileKey = key;\n\n\t\t\tfileList.querySelectorAll('.active').forEach(active => active.classList.remove('active'));\n\t\t\tconst activeFile = fileList.querySelector(`[data-key=\"${key}\"`);\n\t\t\tif (activeFile) {\n\t\t\t\tactiveFile.classList.add('active');\n\t\t\t}\n\n\t\t\tconst file = this.fm.getOneByKey(activeFileKey);\n\t\t\tapp.emit('activatefile', file);\n\t\t};\n\n\t\t// load existing files\n\t\tconst allFiles = this.fm.getAll();\n\t\tconst sortedFiles = _.sortBy(allFiles, o => o.title);\n\n\t\tif (sortedFiles.length) {\n\t\t\tsortedFiles.forEach( file => {\n\t\t\t\tinsertFile(file);\n\t\t\t});\n\t\t\tactivateFile(sortedFiles[0].key);\n\t\t}\n\n\n\n\t\t// Add behaviour events\n\t\tconst createNewFile = () => {\n\t\t\tconst newFile = this.fm.create();\n\n\t\t\tconst newFileElement = insertFile(newFile);\n\t\t\tactivateFile(newFile.key);\n\n\t\t\t_.defer(() => makeTitleEditable(newFileElement));\n\t\t};\n\n\t\tconst deleteFile = () => {\n\t\t\tthis.fm.deleteOne(activeFileKey);\n\n\t\t\tconst toDelete = fileList.querySelector(`[data-key=\"${activeFileKey}\"]`);\n\n\t\t\tif (toDelete) {\n\t\t\t\tconst toActivate = (toDelete.previousSibling)\n\t\t\t\t\t? toDelete.previousSibling\n\t\t\t\t\t: toDelete.nextSibling;\n\n\t\t\t\tfileList.removeChild(toDelete);\n\n\t\t\t\tif (toActivate) {\n\t\t\t\t\tactivateFile(toActivate.dataset.key);\n\n\t\t\t\t} else {\n\t\t\t\t\tactiveFileKey = null;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// todo: don't pass around event object\n\t\tconst preventEnterKey = e => {\n\t\t\tif (e.which === 13) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t};\n\n\t\tconst blurOnEnter = e => {\n\t\t\tif (e.which === 13 && e.target.contentEditable) {\n\t\t\t\te.target.blur();\n\t\t\t\te.target.contentEditable = false;\n\t\t\t}\n\t\t};\n\n\t\tconst activateEntry = e => {\n\t\t\tif (e.detail === 1) {\n\t\t\t\tconst keyElement = e.target.closest('[data-key]');\n\t\t\t\tactivateFile(keyElement.dataset.key);\n\t\t\t}\n\t\t};\n\n\t\tconst makeTitleEditable = entry => {\n\t\t\tconst title = entry.querySelector('.entry-title');\n\t\t\ttitle.contentEditable = true;\n\t\t\ttitle.focus();\n\n\t\t\tconst range = new Range();\n\t\t\trange.selectNodeContents(title);\n\t\t\tconst selection = window.getSelection();\n\t\t\tselection.removeAllRanges();\n\t\t\tselection.addRange(range);\n\t\t};\n\n\t\tconst autosaveTitle = e => {\n\t\t\tconst keyElement = e.target.closest('[data-key]');\n\t\t\tthis.fm.updateTitle(keyElement.dataset.key, e.target.innerText); //todo sanitize\n\t\t\t//todo prevent empty\n\t\t};\n\n\t\tconst autoBlurContentEditableElements = e => {\n\t\t\tconst allEditable = fileList.querySelectorAll('[contenteditable=\"true\"]');\n\t\t\tallEditable.forEach(editable => {\n\t\t\t\tif (!editable.isSameNode(e.target)) {\n\t\t\t\t\teditable.contentEditable = false;\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\twindow.addEventListener('click', autoBlurContentEditableElements);\n\n\t\tnewFileBtn.addEventListener('click', createNewFile);\n\t\tdeleteFileBtn.addEventListener('click', deleteFile);\n\n\t\tfileList.addEventListener('keypress', preventEnterKey);\n\t\tfileList.addEventListener('keypress', blurOnEnter);\n\t\tfileList.addEventListener('input', _.throttle(autosaveTitle, autosaveIntervalMs));\n\t\tfileList.addEventListener('click', activateEntry);\n\t\tfileList.addEventListener('dblclick', e => makeTitleEditable(e.target.parentElement)); //todo fix bug when click outside of title div\n\n\t\tapp.on('editorchange', fileContent => {\n\t\t\tthis.fm.updateContent(activeFileKey, fileContent);\n\t\t});\n\n\t\t// attach to document\n\t\tsideBar.appendChild(fileExplorer);\n\t},\n\n\tinit() {\n\t\tthis.fm = fileManagerFactory();\n\t}\n});\n\nexport default fileExplorerPlugin;\n\n\n\n/**\n // Drag & drop\n const body = document.body;\n body.ondragover = () => {\n\tbody.classList.add('hover');\n\treturn false;\n};\n body.ondragleave = () => {\n\tbody.classList.remove('hover');\n\treturn false;\n};\n\n body.ondrop = e => {\n\tbody.classList.remove('hover');\n\te.preventDefault();\n\n\tconst file = e.dataTransfer.files[0];\n\tconst reader = new FileReader();\n\n\treader.onload = function(event) {\n\t\teditor.load(toNode(event.target.result));\n\t};\n\treader.readAsText(file);\n\n\treturn false;\n};\n **/","import pluginFactory from '../../../app/core/plugin';\nimport htmlToElement from '../../../core/dom/htmlToElement';\n\nimport renderingOptionsTpl from './renderingOptions.hbs';\n\nconst renderingOptionsPlugin = pluginFactory({\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst header = areaBroker.getHeader();\n\n\t\tconst renderingOptions = new DocumentFragment();\n\t\trenderingOptions.appendChild(htmlToElement(renderingOptionsTpl()));\n\n\n\t\t// align bars\n\t\tconst alignBars = renderingOptions.querySelector('[data-option=\"align-bars\"]');\n\t\talignBars.addEventListener('change', e => {\n\t\t\tapp.emit('optionchange', {\n\t\t\t\talignBars: e.target.checked\n\t\t\t});\n\t\t});\n\n\n\t\t// transpose\n\t\tconst transposeDown = renderingOptions.querySelector('[data-option=\"transpose-down\"]');\n\t\tconst transposeUp = renderingOptions.querySelector('[data-option=\"transpose-up\"]');\n\t\tconst transposeValue = renderingOptions.querySelector('[data-option=\"transpose-value\"]');\n\n\t\ttransposeDown.addEventListener('click', () => transpose(-1));\n\t\ttransposeUp.addEventListener('click', () => transpose(1));\n\n\t\tfunction transpose(step) {\n\t\t\tconst currentTransposeValue = Number.parseInt(transposeValue.innerText);\n\t\t\tconst newTransposeValue = currentTransposeValue + step;\n\t\t\tapp.emit('optionchange', {\n\t\t\t\ttransposeValue: newTransposeValue\n\t\t\t});\n\t\t\ttransposeValue.innerText = (newTransposeValue) > 0 ?'+' + newTransposeValue : newTransposeValue;\n\t\t}\n\n\n\t\t// Harmonize accidentals\n\t\tconst harmonizeAccidentals = renderingOptions.querySelector('[data-option=\"harmonize-accidentals\"]');\n\t\tharmonizeAccidentals.addEventListener('change', () => {\n\t\t\tconst checked = harmonizeAccidentals.querySelector('input[name=\"ha\"]:checked');\n\t\t\tapp.emit('optionchange', {\n\t\t\t\tharmonizeAccidentals: (checked.value === 'true')\n\t\t\t});\n\t\t});\n\n\t\t// accidentals type\n\t\tconst accidentalsType = renderingOptions.querySelector('[data-option=\"accidentals-type\"]');\n\t\taccidentalsType.addEventListener('change', () => {\n\t\t\tconst checked = accidentalsType.querySelector('input[name=\"ht\"]:checked');\n\t\t\tapp.emit('optionchange', {\n\t\t\t\taccidentalsType: checked.value\n\t\t\t});\n\t\t});\n\n\n\t\t// app.on('optionchange', console.log);\n\n\t\t// attach to document\n\t\theader.appendChild(renderingOptions);\n\t}\n});\n\nexport default renderingOptionsPlugin;\n\n","import '../../scss/styles.scss';\n\nimport areaBrokerFactory from './core/areaBroker';\nimport appFactory from './core/app';\nimport registerPlugins from './registerPlugins';\n\nconst areas = {\n\theader: '[data-area=\"app-header\"]',\n\tfooter: '[data-area=\"app-footer\"]',\n\tsideBar: '[data-area=\"app-side-bar\"]',\n\tcontent: '[data-area=\"app-content\"]',\n};\n\nconst areaBroker = areaBrokerFactory(areas);\nconst app = appFactory(areaBroker);\n\nregisterPlugins(app);\n\napp.init()\n\t.then(() => {\n\t\treturn app.render();\n\t});\n\n\n\n/**\nconst alignRenderingSwitch = document.querySelector('#aligned-rendering');\n\nalignRenderingSwitch.addEventListener('change', () => {\n\teditor.load(editorNode);\n});\n**/\n","import _ from 'lodash';\nimport EventEmitter from 'eventemitter2';\n\nexport default function appFactory(areaBroker) {\n\tconst pluginRegistry = [];\n\n\tconst app = new EventEmitter();\n\n\tasync function pluginRun(method) {\n\t\tlet plugin;\n\n\t\tfor (let i = 0; i < pluginRegistry.length; i++) {\n\t\t\tplugin = pluginRegistry[i];\n\n\t\t\tif (_.isFunction(plugin[method])) {\n\t\t\t\tawait plugin[method]();\n\t\t\t}\n\t\t}\n\t\tthis.emit(method);\n\t}\n\n\treturn Object.assign(app, {\n\t\tgetAreaBroker() {\n\t\t\treturn areaBroker;\n\t\t},\n\n\t\tregisterPlugin(plugin) {\n\t\t\tplugin.setHost(this);\n\t\t\tpluginRegistry.push(plugin);\n\t\t},\n\n\t\tinit() {\n\t\t\treturn pluginRun.call(this, 'init');\n\t\t},\n\n\t\trender() {\n\t\t\treturn pluginRun.call(this, 'render');\n\t\t}\n\t});\n}","import _ from 'lodash';\n\n/**\n * @param areas - key/value pairs where key = areaId and value = cssSelector\n */\nexport default function areaBrokerFactory(areas) {\n\n\tconst areaBroker = {};\n\n\tlet getterName;\n\n\t_.forEach(areas,  (cssSelector, areaId) => {\n\t\tgetterName = 'get' + areaId.charAt(0).toUpperCase() + areaId.slice(1);\n\n\t\tareaBroker[getterName] = () => {\n\t\t\tconst area = document.querySelectorAll(cssSelector);\n\n\t\t\tif (area.length === 0) {\n\t\t\t\tthrow new Error('Cannot find area: ' + areaId + ' with selector: ' + cssSelector);\n\n\t\t\t} else if (area.length > 1) {\n\t\t\t\tthrow new Error('Multiple areas: ' + areaId + ' found with selector: ' + cssSelector);\n\t\t\t}\n\t\t\treturn area.item(0);\n\t\t};\n\t});\n\n\treturn areaBroker;\n}","import header from './plugins/content/header/plugin';\nimport footer from './plugins/content/footer/plugin';\nimport editor from './plugins/editor/plugin';\nimport fileExplorer from './plugins/fileExplorer/plugin';\nimport renderingOptions from './plugins/renderingOptions/plugin';\n\nexport default function registerPlugins(app) {\n\tapp.registerPlugin(header);\n\tapp.registerPlugin(footer);\n\tapp.registerPlugin(editor);\n\tapp.registerPlugin(fileExplorer);\n\tapp.registerPlugin(renderingOptions);\n}","var Handlebars = require(\"../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<div class=\\\"cp2-song\\\">\"\n    + ((stack1 = container.lambda((depth0 != null ? depth0.song : depth0), depth0)) != null ? stack1 : \"\")\n    + \"</div>\";\n},\"useData\":true});","var Handlebars = require(\"../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<p class=\\\"cp2-text-line\\\">\"\n    + ((stack1 = container.lambda((depth0 != null ? depth0.textLine : depth0), depth0)) != null ? stack1 : \"\")\n    + \"</p>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"rendering-options\\\">\\n    <div class=\\\"panel\\\">\\n        <input type=\\\"checkbox\\\" id=\\\"align-bars\\\" data-option=\\\"align-bars\\\" checked><label for=\\\"align-bars\\\">Align bars</label><br />\\n    </div>\\n    <div class=\\\"panel\\\">\\n        Transpose: <button data-option=\\\"transpose-down\\\">-1</button> <span data-option=\\\"transpose-value\\\">0</span> <button data-option=\\\"transpose-up\\\">+1</button><br />\\n        <div data-option=\\\"harmonize-accidentals\\\">\\n            Unify flats / sharps\\n            <input type=\\\"radio\\\" id=\\\"harmonize-accidentals-false\\\" name=\\\"ha\\\" value=\\\"false\\\"><label for=\\\"harmonize-accidentals-false\\\">No</label>\\n            <input type=\\\"radio\\\" id=\\\"harmonize-accidentals-true\\\" name=\\\"ha\\\" value=\\\"true\\\" checked><label for=\\\"harmonize-accidentals-true\\\">Yes</label><br/>\\n        </div>\\n        <div data-option=\\\"accidentals-type\\\">\\n            Accidentals\\n            <input type=\\\"radio\\\" id=\\\"accidentals-type-auto\\\" name=\\\"ht\\\" value=\\\"auto\\\" checked><label for=\\\"accidentals-type-auto\\\">Auto</label>\\n            <input type=\\\"radio\\\" id=\\\"accidentals-type-flat\\\" name=\\\"ht\\\" value=\\\"flat\\\"><label for=\\\"accidentals-type-flat\\\">Flat</label>\\n            <input type=\\\"radio\\\" id=\\\"accidentals-type-sharp\\\" name=\\\"ht\\\" value=\\\"sharp\\\"><label for=\\\"accidentals-type-sharp\\\">Sharp</label>\\n        </div>\\n    </div>\\n</div>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"app-footer\\\">\\n    Chord+ v0.3.0\\n</div>\\n\";\n},\"useData\":true});","var Handlebars = require(\"../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\", alias4=container.escapeExpression;\n\n  return \"<li class=\\\"entry\\\" data-key=\\\"\"\n    + alias4(((helper = (helper = helpers.key || (depth0 != null ? depth0.key : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"key\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\">\\n    <div class=\\\"entry-title\\\">\"\n    + alias4(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"title\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</div>\\n</li>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"file-explorer\\\">\\n    <div class=\\\"file-explorer-actions\\\">\\n        <button data-action=\\\"new-file\\\">New file</button>\\n        <button data-action=\\\"delete-file\\\">Delete</button>\\n    </div>\\n    <hr />\\n    <ul class=\\\"entry-list\\\"></ul>\\n</div>\";\n},\"useData\":true});"],"sourceRoot":""}