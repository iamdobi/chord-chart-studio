{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/app/plugins/content/header/header.hbs","webpack:///../ucc/src/renderer/chord/chordSymbol.hbs","webpack:///../ucc/src/renderer/song/song.hbs","webpack:///./src/app/plugins/editor/editor.hbs","webpack:///../ucc/src/renderer/text/textLine.hbs","webpack:///./src/app/core/plugin.js","webpack:///./src/core/dom/htmlToElement.js","webpack:///./src/app/plugins/content/header/plugin.js","webpack:///./src/app/plugins/content/footer/plugin.js","webpack:///../ucc/src/parser/isChord.js","webpack:///../ucc/src/parser/isChordLine.js","webpack:///../ucc/src/parser/isTimeSignatureString.js","webpack:///../ucc/src/parser/parseTimeSignature.js","webpack:///../ucc/src/parser/parseChord.js","webpack:///../ucc/src/parser/exceptions/IncorrectBeatCountException.js","webpack:///../ucc/src/parser/exceptions/InvalidChordRepetitionException.js","webpack:///../ucc/src/parser/parseChordLine.js","webpack:///../ucc/src/renderer/helper/songs.js","webpack:///../ucc/src/parser/parseSong.js","webpack:///../ucc/src/parser/getAllChordsInSong.js","webpack:///../ucc/src/editor/prosemirror/plugins/onStateChange.js","webpack:///../ucc/src/editor/prosemirror/schema.js","webpack:///../ucc/src/editor/prosemirror/helpers/stateToArray.js","webpack:///../ucc/src/renderer/spacer/chord/simple.js","webpack:///../ucc/src/renderer/spacer/chord/aligned.js","webpack:///../ucc/src/renderer/transposeChord.js","webpack:///../ucc/src/renderer/transposeSong.js","webpack:///../ucc/src/renderer/getMainAccidental.js","webpack:///../ucc/src/renderer/isRenderer.js","webpack:///../ucc/src/renderer/bar/barContent.js","webpack:///../ucc/src/renderer/chord/chordLine.js","webpack:///../ucc/src/renderer/chord/chordSymbol.js","webpack:///../ucc/src/renderer/text/textLine.js","webpack:///../ucc/src/renderer/getChordSymbol.js","webpack:///../ucc/src/renderer/song/song.js","webpack:///../ucc/src/renderer/getMaxBeatsWidth.js","webpack:///../ucc/src/index-editor.js","webpack:///../ucc/src/editor/prosemirror/editor.js","webpack:///../ucc/src/editor/prosemirror/getPlugins.js","webpack:///./src/app/plugins/editor/plugin.js","webpack:///./src/app/core/store.js","webpack:///./src/app/plugins/fileExplorer/fileManager.js","webpack:///./src/app/plugins/fileExplorer/plugin.js","webpack:///./src/app/plugins/renderingOptions/plugin.js","webpack:///./src/app/main.js","webpack:///./src/app/core/app.js","webpack:///./src/app/core/areaBroker.js","webpack:///./src/app/registerPlugins.js","webpack:///../ucc/src/renderer/bar/barSeparator.hbs","webpack:///../ucc/src/renderer/bar/barContent.hbs","webpack:///../ucc/src/renderer/chord/chordLine.hbs","webpack:///./src/app/plugins/renderingOptions/renderingOptions.hbs","webpack:///./src/app/plugins/content/footer/footer.hbs","webpack:///./src/app/plugins/fileExplorer/entry.hbs","webpack:///./src/app/plugins/fileExplorer/fileExplorer.hbs"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","Handlebars","template","compiler","main","container","depth0","helpers","partials","useData","escapeExpression","lambda","chordSymbol","stack1","song","textLine","pluginFactory","pluginDef","plugin","EventEmitter","host","assign","getHost","Error","setHost","newHost","htmlToElement","html","document","createElement","trim","innerHTML","content","firstChild","headerPlugin","render","headerArea","this","getAreaBroker","getHeader","header","headerTpl","appendChild","footerPlugin","footerArea","getFooter","footer","footerTpl","chords","Chords","isChordLine","line","replace","split","map","potentialChord","every","_","isString","isChord","allowedTimeSignatures","isTimeSignatureString","string","includes","parseTimeSignature","TypeError","array","count","Number","parseInt","beatCount","IncorrectBeatCountException","constructor","duration","currentBeatCount","isFinite","super","InvalidChordRepetitionException","parseChordLine","chordLine","timeSignature","allLineChords","allBars","bar","allChords","chord","model","chordCount","previousChord","forEach","chordString","parse","parseChord","match","beat","isEqual","cloneDeep","message","forEachChordInSong","allLines","fn","newLines","type","defaultTimeSignature","parseSong","isArray","isTimeSignature","e","findIndex","occurrences","getAllChordsInSong","onStateChangeFactory","editor","pmPlugin","view","update","editorView","emit","state","editorSchema","Schema","nodes","marks","stateToArray","toJSON","doc","paragraph","reduce","acc","current","text","allMasks","","2","11","3","12","21","111","4","13","22","31","112","121","211","1111","spacesAfterDefault","emptyBeatSpaces","notes","sharpsToFlats","C#","D#","F#","G#","A#","flatsToSharps","invert","convertToSharp","note","transposeNote","useFlats","transposedIndex","indexOf","octaves","Math","floor","transposed","transposeSong","transposeValue","accidentalsType","harmonizeAccidentals","accidental","rootNote","flatCount","sharpCount","symbol","getMainAccidental","transposedModel","transposedChord","root","bass","bassNote","rootSharp","bassSharp","transposeChord","isRenderer","renderer","isObject","isFunction","renderer_bar_barContent","chordRenderer","spacesWithin","spacesAfter","barContent","rendering","repeat","barContentTpl","renderer_chord_chordLine","chordLineModel","barContentRenderer","allBarsRendered","barSeparator","barSeparatorTpl","join","chordLineTpl","renderer_chord_chordSymbol","chordSymbolTpl","renderer_text_textLine","textLineTpl","getChordSymbol","chordDef","print","renderer_song_song","songTxt","alignBars","parsedSong","maxBeatsWidth","filter","barIndex","max","getMaxBeatsWidth","spaced","chordLineInput","beatMaxWidth","alignedChordSpacer","chordPattern","chordSpaces","toString","simpleChordSpacer","rendered","chordLineRenderer","chordSymbolRenderer","textLineRenderer","songTpl","editorFactory","renderTo","EventEmitter2","editorPlugins","pmHistory","keymap","Mod-z","undo","Mod-y","redo","baseKeymap","onStateChange","getPlugins","on","load","newContent","newState","EditorState","pmDOMParser","fromSchema","plugins","updateState","EditorView","getContent","songRenderer","songRendererFactory","editorPlugin","app","contentArea","editorDom","editorTpl","renderingOptions","editorNode","querySelector","previewContainer","previewSong","songLines","childNodes","replaceChild","newOptions","file","div","toNode","store","localStorage","getItem","setItem","JSON","stringify","getOneByKey","getAllByKeyPrefix","keyPrefix","allEntries","delete","removeItem","fileExplorerFactory","fileManager","newFile","nanoid","title","getAll","updateContent","updateTitle","deleteOne","fileExplorerPlugin","sideBar","getSideBar","fileExplorer","DocumentFragment","activeFileKey","fileExplorerTpl","newFileBtn","deleteFileBtn","fileList","insertFile","newEntry","fileEntryTpl","activeFile","nextSibling","insertBefore","activateFile","querySelectorAll","active","classList","remove","add","fm","allFiles","sortedFiles","sortBy","makeTitleEditable","entry","contentEditable","focus","range","Range","selectNodeContents","selection","getSelection","removeAllRanges","addRange","addEventListener","editable","isSameNode","target","newFileElement","defer","toDelete","toActivate","previousSibling","removeChild","dataset","which","preventDefault","stopPropagation","blur","throttle","keyElement","closest","innerText","detail","parentElement","fileContent","init","fileManagerFactory","renderingOptionsPlugin","renderingOptionsTpl","checked","transposeDown","transposeUp","transpose","step","newTransposeValue","areaBroker","pluginRegistry","async","pluginRun","method","registerPlugin","appFactory","areas","getterName","cssSelector","areaId","charAt","toUpperCase","area","item","areaBrokerFactory","then","helper","alias1","nullContext","alias2","helperMissing","alias4","hash"],"mappings":"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","file":"main.32ca10b27b58437e965f.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([\"NjgO\",1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var Handlebars = require(\"../../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"app-header\\\">\\n    <div class=\\\"h2-like\\\">Universal Chords Charts</div>\\n    <div>For real.</div>\\n</div>\\n\";\n},\"useData\":true});","var Handlebars = require(\"../../../../ucc-demo/node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<span class=\\\"cp2-chord-symbol\\\">\"\n    + container.escapeExpression(container.lambda((depth0 != null ? depth0.chordSymbol : depth0), depth0))\n    + \"</span>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../ucc-demo/node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<div class=\\\"cp2-song\\\">\"\n    + ((stack1 = container.lambda((depth0 != null ? depth0.song : depth0), depth0)) != null ? stack1 : \"\")\n    + \"</div>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"editor-area\\\">\\n    <section class=\\\"left\\\">\\n        <div id=\\\"source\\\"></div>\\n    </section>\\n\\n    <section class=\\\"right\\\">\\n        <div id=\\\"preview\\\"><div></div></div>\\n    </section>\\n</div>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../ucc-demo/node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<p class=\\\"cp2-text-line\\\">\"\n    + ((stack1 = container.lambda((depth0 != null ? depth0.textLine : depth0), depth0)) != null ? stack1 : \"\")\n    + \"</p>\";\n},\"useData\":true});","import EventEmitter from 'eventemitter2';\n\nexport default function pluginFactory(pluginDef) {\n\tconst plugin = new EventEmitter();\n\n\tlet host;\n\n\treturn Object.assign(plugin, pluginDef, {\n\t\tgetHost() {\n\t\t\tif (!host) {\n\t\t\t\tthrow new Error('Plugin\\'s host has not been setup, cannot retrieve it');\n\t\t\t}\n\t\t\treturn host;\n\t\t},\n\n\t\tsetHost(newHost) {\n\t\t\tif (host) {\n\t\t\t\tthrow new Error('Cannot override Plugin\\'s host');\n\t\t\t}\n\t\t\thost = newHost;\n\t\t}\n\t});\n}","// https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro\nexport default function htmlToElement(html) {\n\tconst template = document.createElement('template');\n\thtml = html.trim();\n\ttemplate.innerHTML = html;\n\treturn template.content.firstChild;\n}","import pluginFactory from '../../../core/plugin';\nimport htmlToElement from '../../../../core/dom/htmlToElement';\n\nimport headerTpl from './header.hbs';\n\nconst headerPlugin = pluginFactory({\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst headerArea = areaBroker.getHeader();\n\n\t\tconst header = htmlToElement(headerTpl());\n\n\t\theaderArea.appendChild(header);\n\t}\n});\n\nexport default headerPlugin;","import pluginFactory from '../../../core/plugin';\nimport htmlToElement from '../../../../core/dom/htmlToElement';\n\nimport footerTpl from './footer.hbs';\n\nconst footerPlugin = pluginFactory({\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst footerArea = areaBroker.getFooter();\n\n\t\tconst footer = htmlToElement(footerTpl());\n\n\t\tfooterArea.appendChild(footer);\n\t}\n});\n\nexport default footerPlugin;","import _ from 'lodash';\n\nimport { Chords } from 'momo-chords';\n\nconst chords = new Chords();\n\nexport default function isChord(potentialChord) {\n\treturn _.isString(potentialChord) && chords.isChord(potentialChord);\n}","import isChord from './isChord';\n\nexport default function isChordLine(line = '') {\n\treturn line\n\t\t.replace(/\\t+/g, ' ')\n\t\t.replace(/  +/g, ' ')\n\t\t.trim()\n\t\t.split(' ')\n\t\t.map(potentialChord => potentialChord.replace(/\\.*$/g, ''))\n\t\t.every(potentialChord => isChord(potentialChord));\n}\n","const allowedTimeSignatures = [\n\t'2/2', '3/2',\n\t'3/4', '4/4', '5/4',\n\t'3/8', '6/8', '9/8', '12/8'\n];\n\nexport default function isTimeSignatureString(string) {\n\treturn allowedTimeSignatures.includes(string);\n}","import isTimeSignatureString from './isTimeSignatureString';\n\n/**\n * @typedef {Object} TimeSignature\n * @type {Object}\n * @property {String} string - original string\n * @property {Number} count - upper part of time signature\n * @property {Number} value - lower part of time signature\n * @property {Number} beatCount - number of beats per bar\n */\n\n/**\n * @param {String} string\n * @returns {TimeSignature}\n */\nexport default function parseTimeSignature(string) {\n\tif (!isTimeSignatureString(string)) {\n\t\tthrow new TypeError('Expected time signature string, received: ' + string);\n\t}\n\n\tconst array = string.split('/');\n\n\tconst count = Number.parseInt(array[0], 10);\n\tconst value = Number.parseInt(array[1], 10);\n\n\tlet beatCount = count;\n\n\tif (value === 2) {\n\t\tbeatCount = count * 2;\n\n\t} else if (value === 8) {\n\t\tbeatCount = count / 3;\n\t}\n\n\treturn {\n\t\tstring,\n\t\tcount,\n\t\tvalue,\n\t\tbeatCount,\n\t};\n}\n\n","import { Chords } from 'momo-chords';\n\nconst chords = new Chords();\n\n/**\n * @see https://github.com/mdanka/momo-chords/blob/master/src/types.ts\n */\n\n/**\n * @typedef {Object} ChordDef\n * @type {Object}\n * @property {ChordSymbol} symbol\n * @property {Object} structure - whether each degree (1, 2, 3... 11) is present (true/false) in the chord\n */\n\n/**\n * @typedef {Object} ChordSymbol\n * @type {Object}\n * @property {String} rootNote\n * @property {String} [bassNote]\n * @property {String} quality\n * @property {Object} addeds\n * @property {Object} suspended\n * @property {String} [alteredFifth]\n * @property {String} [seventh]\n * @property {String} [ninth]\n * @property {String} [eleventh]\n * @property {String} [thirteenth]\n */\n\n/**\n * @param chordString\n * @returns {ChordDef}\n */\nexport default function parseChord(chordString) {\n\treturn chords.parse(chordString);\n}\n","import _ from 'lodash';\n\nexport default class IncorrectBeatCountException extends Error {\n\tconstructor(\n\t\t{\n\t\t\tstring,\n\t\t\tduration,\n\t\t\tcurrentBeatCount,\n\t\t\tbeatCount\n\t\t} = {}\n\t) {\n\t\tif (!string || !_.isString(string)) {\n\t\t\tthrow new TypeError('IncorrectBeatCountException cannot be created without chord string, received: ' + string);\n\t\t}\n\t\tif (!duration || !_.isFinite(duration)) {\n\t\t\tthrow new TypeError('IncorrectBeatCountException cannot be created without chord duration, received: ' + duration);\n\t\t}\n\t\tif (!currentBeatCount || !_.isFinite(currentBeatCount)) {\n\t\t\tthrow new TypeError('IncorrectBeatCountException cannot be created without currentBeatCount, received: ' + currentBeatCount);\n\t\t}\n\t\tif (!beatCount || !_.isFinite(beatCount)) {\n\t\t\tthrow new TypeError('IncorrectBeatCountException cannot be created without beatCount, received: ' + beatCount);\n\t\t}\n\n\t\tsuper();\n\n\t\tthis.name = 'IncorrectBeatCountException';\n\t\tthis.string = string;\n\t\tthis.duration = duration;\n\t\tthis.currentBeatCount = currentBeatCount;\n\t\tthis.beatCount = beatCount;\n\t}\n}\n\n","import _ from 'lodash';\n\nexport default class InvalidChordRepetitionException extends Error {\n\tconstructor(\n\t\t{\n\t\t\tstring,\n\t\t} = {}\n\t) {\n\t\tif (!string || !_.isString(string)) {\n\t\t\tthrow new TypeError('InvalidChordRepetitionException cannot be created without chord string, received: ' + string);\n\t\t}\n\n\t\tsuper();\n\n\t\tthis.name = 'InvalidChordRepetitionException';\n\t\tthis.string = string;\n\t}\n}\n\n","import _ from 'lodash';\n\nimport parseChord from './parseChord';\nimport parseTimeSignature from './parseTimeSignature';\n\nimport IncorrectBeatCountException from './exceptions/IncorrectBeatCountException';\nimport InvalidChordRepetitionException from './exceptions/InvalidChordRepetitionException';\n\n/**\n * @typedef {Object} ChordLine\n * @type {Object}\n * @property {Number} chordCount - number of chords in the line\n * @property {Bar[]} allBars\n */\n\n/**\n * @typedef {Object} Bar\n * @type {Object}\n * @property {TimeSignature} timeSignature\n * @property {ChordLineChord[]} allChords\n */\n\n/**\n * @typedef {Object} ChordLineChord\n * @type {Object}\n * @property {String} string - original chord string\n * @property {ChordDef} model\n * @property {Number} duration - number of beats the chord lasts\n * @property {Number} beat - beat on which the chord starts\n */\n\n/**\n * @param {String} chordLine\n * @param {TimeSignature} timeSignature\n * @returns {ChordLine}\n */\nexport default function parseChordLine(\n\tchordLine,\n\t{\n\t\ttimeSignature = parseTimeSignature('4/4')\n\t} = {}\n) {\n\tconst { beatCount } = timeSignature;\n\n\tconst allLineChords = chordLine\n\t\t.replace(/  +/g, ' ')\n\t\t.trim()\n\t\t.split(' ');\n\tconst allBars = [];\n\n\tlet bar = { allChords: []};\n\tlet chord = {};\n\tlet model = {};\n\tlet currentBeatCount = 0;\n\tlet chordCount = 0;\n\tlet previousChord = {};\n\n\tallLineChords.forEach(chordString => {\n\t\tmodel = parseChord(chordString.replace(/\\./g, ''));\n\t\tchord = {\n\t\t\tstring: chordString,\n\t\t\tduration: ((chordString.match(/\\./g) || []).length) || beatCount,\n\t\t\tmodel,\n\t\t};\n\t\tchord.beat = currentBeatCount + 1;\n\t\tcurrentBeatCount += chord.duration;\n\n\t\tif (bar.allChords.length > 0) {\n\t\t\tpreviousChord = bar.allChords[bar.allChords.length - 1];\n\t\t\tif (_.isEqual(previousChord.model, chord.model)) {\n\t\t\t\tthrow new InvalidChordRepetitionException({\n\t\t\t\t\tstring: chord.string,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tbar.allChords.push(chord);\n\t\tchordCount++;\n\n\t\tif (currentBeatCount === beatCount) {\n\t\t\tbar.timeSignature = timeSignature;\n\n\t\t\tallBars.push(_.cloneDeep(bar));\n\n\t\t\tbar = { allChords: []};\n\t\t\tcurrentBeatCount = 0;\n\t\t\tpreviousChord = {};\n\n\t\t} else if (currentBeatCount > beatCount) {\n\t\t\tthrow new IncorrectBeatCountException({\n\t\t\t\tmessage: '',\n\t\t\t\tstring: chord.string,\n\t\t\t\tduration: chord.duration,\n\t\t\t\tcurrentBeatCount,\n\t\t\t\tbeatCount,\n\t\t\t});\n\t\t}\n\t});\n\n\tif (currentBeatCount > 0 && (currentBeatCount < beatCount)) {\n\t\tthrow new IncorrectBeatCountException({\n\t\t\tmessage: '',\n\t\t\tstring: chord.string,\n\t\t\tduration: chord.duration,\n\t\t\tcurrentBeatCount,\n\t\t\tbeatCount,\n\t\t});\n\t}\n\n\treturn {\n\t\tchordCount,\n\t\tallBars\n\t};\n}\n","import _ from 'lodash';\n\n/**\n * @param {SongLine[]} allLines\n * @param {Function} fn - to execute on each chord\n * @returns {SongLine[]}\n */\nexport function forEachChordInSong(allLines, fn) {\n\tconst newLines = _.cloneDeep(allLines);\n\n\tnewLines.forEach(line => {\n\t\tif (line.type === 'chord') {\n\t\t\tline.model.allBars.forEach(bar => {\n\t\t\t\tbar.allChords.forEach(chord => {\n\t\t\t\t\tfn(chord);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\treturn newLines;\n}\n\n/**\n * @param {ChordLine[]} chordLine\n * @param {Function} fn - to execute on each chord\n * @returns {ChordLine[]}\n */\nexport function forEachChordInChordLine(chordLine, fn) {\n\tconst newChordLine = _.cloneDeep(chordLine);\n\n\tnewChordLine.allBars.forEach(bar => {\n\t\tbar.allChords.forEach(chord => {\n\t\t\tfn(chord);\n\t\t});\n\t});\n\n\treturn newChordLine;\n}\n","import _ from 'lodash';\n\nimport isChordLine from './isChordLine';\nimport isTimeSignature from './isTimeSignatureString';\n\nimport parseTimeSignature from './parseTimeSignature';\nimport parseChordLine from './parseChordLine';\n\nimport getAllChordsInSong from './getAllChordsInSong';\n\n/**\n * @typedef {Object} SongLine\n * @type {Object}\n * @property {String} string - original line in source file\n * @property {String} type - chord|text|time-signature|...\n * @property {ChordLine|TimeSignature} model\n */\n\n/**\n * @typedef {Object} Song\n * @type {Object}\n * @property {SongLine[]} allLines\n * @property {SongChord[]} allChords\n */\n\n/**\n * @typedef {Object} SongChord\n * @type {Object}\n * @property {ChordDef} model\n * @property {number} occurrences - number of times the chord appears in the song\n */\n\n/**\n * @type {string}\n */\nconst defaultTimeSignature = '4/4';\n\n/**\n * @param {string|array} song\n * @returns {Song}\n */\nexport default function parseSong(song) {\n\n\tlet timeSignature = parseTimeSignature(defaultTimeSignature);\n\n\tconst songLines = (!_.isArray(song)) ? song.split('\\n') : song;\n\n\tconst allLines = songLines\n\t\t.map(string => ({ string }))\n\t\t.map(line => {\n\t\t\tif (isTimeSignature(line.string)) {\n\t\t\t\ttimeSignature = parseTimeSignature(line.string);\n\n\t\t\t\tline.type = 'time-signature';\n\t\t\t\tline.model = timeSignature;\n\n\t\t\t} else if (isChordLine(line.string)) {\n\t\t\t\ttry {\n\t\t\t\t\tline.type = 'chord';\n\t\t\t\t\tline.model = parseChordLine(line.string, { timeSignature });\n\n\t\t\t\t} catch (e) {\n\t\t\t\t\tline.type = 'text';\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tline.type = 'text';\n\t\t\t}\n\t\t\treturn line;\n\t\t});\n\n\n\tconst allChords = getAllChordsInSong(allLines);\n\n\treturn {\n\t\tallLines,\n\t\tallChords\n\t};\n}\n","import _ from 'lodash';\n\nimport { forEachChordInSong } from '../renderer/helper/songs';\n\n/**\n * @param {SongLine[]} allLines\n * @returns {SongChord[]}\n */\nexport default function getAllChordsInSong(allLines) {\n\tconst allChords = [];\n\tlet i;\n\n\tforEachChordInSong(allLines, chord => {\n\t\ti = _.findIndex(allChords, o => _.isEqual(o.model, chord.model));\n\n\t\tif (i === -1) {\n\t\t\tallChords.push({\n\t\t\t\tmodel: _.cloneDeep(chord.model),\n\t\t\t\toccurrences: 1\n\t\t\t});\n\t\t} else {\n\t\t\tallChords[i].occurrences++;\n\t\t}\n\t});\n\n\treturn allChords;\n}\n","import { Plugin as pmPlugin } from 'prosemirror-state';\n\nexport default function onStateChangeFactory(editor) {\n\treturn new pmPlugin({\n\t\tkey: 'onStateChange',\n\t\tview: () => {\n\t\t\treturn {\n\t\t\t\tupdate(editorView) {\n\t\t\t\t\teditor.emit('statechange', editorView.state);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t});\n}\n","import { Schema } from 'prosemirror-model';\nimport { nodes, marks } from 'prosemirror-schema-basic';\n\nconst editorSchema = new Schema({\n\tnodes: nodes,\n\tmarks: marks\n});\n\nexport default editorSchema;","/**\n * Convert a prosemirror state to an array of lines, with only text and no formatting\n */\nexport default function stateToArray(state) {\n\tconst json = state.toJSON();\n\n\treturn json.doc.content.map(paragraph => {\n\t\tif (!paragraph.content) {\n\t\t\treturn '';\n\t\t}\n\t\treturn paragraph.content.reduce((acc, current) => {\n\t\t\tacc += current.text;\n\t\t\treturn acc;\n\t\t}, '');\n\t});\n}","import _ from 'lodash';\n\nconst allMasks = {\n\t0: {\n\t\t'': []\n\t},\n\n\t2: {\n\t\t'2': \t[3], \t\t// 'A   '\n\t\t'11':  \t[3, 2], \t// 'A   B  ',\n\t},\n\n\t3: {\n\t\t'3': \t[3], \t\t// 'A   '\n\t\t'12':  \t[2, 4], \t// 'A  B    '\n\t\t'21': \t[6, 0], \t// 'A      C'\n\t\t'111': \t[2, 2, 0], \t// 'A  B  C'\n\t},\n\n\t4: {\n\t\t'4': \t[3], \t\t// 'A   ',\n\t\t'13': \t[1, 4], \t// 'A B    ',\n\t\t'22': \t[3, 2], \t// 'A   B  ',\n\t\t'31':   [5, 0], \t// 'A     B',\n\t\t'112':  [1, 1, 3], \t// 'A B C   ',\n\t\t'121':  [1, 4, 0], \t// 'A B    C',\n\t\t'211': \t[4, 1, 0], \t// 'A    B C',\n\t\t'1111': [2, 2, 2], \t// 'A  B  C  D',\n\t},\n};\n\nexport default function space(chordLineInput) {\n\tconst chordLine = _.cloneDeep(chordLineInput);\n\n\tlet beatCount = 0;\n\tlet chordPattern = '';\n\tlet chordSpaces = [];\n\n\tchordLine.allBars.forEach(bar => {\n\t\tbeatCount = 0;\n\t\tchordPattern = '';\n\n\t\tbar.allChords.forEach(chord => {\n\t\t\tchordPattern += chord.duration.toString();\n\t\t\tbeatCount += chord.duration;\n\t\t});\n\n\t\tchordSpaces = allMasks[beatCount][chordPattern];\n\n\t\tfor (let i = 0; i < chordPattern.length; i++) {\n\t\t\tbar.allChords[i].spacesAfter = chordSpaces[i];\n\t\t}\n\t});\n\n\treturn chordLine;\n}\n","import _ from 'lodash';\n\nconst spacesAfterDefault = 2;\nconst emptyBeatSpaces = 1;\n\nexport default function space(chordLineInput, maxBeatsWidth) {\n\tconst chordLine = _.cloneDeep(chordLineInput);\n\n\tlet beatMaxWidth;\n\n\tchordLine.allBars.forEach((bar, barIndex) => {\n\t\tbar.allChords.forEach(chord => {\n\t\t\tchord.spacesWithin = maxBeatsWidth[barIndex][chord.beat] - chord.symbol.length;\n\t\t\tchord.spacesAfter = 0;\n\n\t\t\tif (chord.beat !== bar.timeSignature.beatCount) {\n\t\t\t\tchord.spacesAfter = spacesAfterDefault;\n\n\t\t\t\tfor (let i = (chord.beat + 1); i < (chord.beat + chord.duration); i++) {\n\t\t\t\t\tbeatMaxWidth = maxBeatsWidth[barIndex][i];\n\n\t\t\t\t\tchord.spacesAfter += (beatMaxWidth)\n\t\t\t\t\t\t? beatMaxWidth\n\t\t\t\t\t\t: emptyBeatSpaces;\n\n\t\t\t\t\tif (i !== bar.timeSignature.beatCount && beatMaxWidth) {\n\t\t\t\t\t\tchord.spacesAfter += spacesAfterDefault;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\treturn chordLine;\n}","import _ from 'lodash';\n\nconst notes = [\n\t'C',\n\t'C#',\n\t'D',\n\t'D#',\n\t'E',\n\t'F',\n\t'F#',\n\t'G',\n\t'G#',\n\t'A',\n\t'A#',\n\t'B',\n];\n\nconst sharpsToFlats = {\n\t'C#': 'Db',\n\t'D#': 'Eb',\n\t'F#': 'Gb',\n\t'G#': 'Ab',\n\t'A#': 'Bb',\n};\n\nconst flatsToSharps = _.invert(sharpsToFlats);\n\nfunction convertToSharp(note) {\n\treturn flatsToSharps[note] || note;\n}\n\nfunction transposeNote(note, value, useFlats) {\n\tconst noteIndex = notes.indexOf(note);\n\tconst transposedIndex = noteIndex + value;\n\n\tconst octaves = Math.floor(transposedIndex / 12);\n\tconst correctedTransposedIndex = transposedIndex - (octaves * 12);\n\n\tconst transposed = notes[correctedTransposedIndex];\n\n\treturn (useFlats)\n\t\t? sharpsToFlats[transposed] || transposed\n\t\t: transposed;\n}\n\nexport default function transposeChord(chord, value, useFlats) {\n\tconst transposedChord = _.cloneDeep(chord); // check immutability\n\n\tconst root = transposedChord.symbol.rootNote;\n\tconst bass = transposedChord.symbol.bassNote;\n\n\tconst rootSharp = convertToSharp(root);\n\ttransposedChord.symbol.rootNote = transposeNote(rootSharp, value, useFlats);\n\n\tif (bass) {\n\t\tconst bassSharp = convertToSharp(bass);\n\t\ttransposedChord.symbol.bassNote = transposeNote(bassSharp, value, useFlats);\n\t}\n\n\treturn transposedChord;\n}","import _ from 'lodash';\nimport transposeChord from './transposeChord';\nimport getMainAccidental from './getMainAccidental';\n\nimport { forEachChordInSong } from './helper/songs';\n\n/**\n * @param {SongLine[]} allLines\n * @param {SongChord[]} allChords\n * @param transposeValue\n * @param accidentalsType\n * @param harmonizeAccidentals\n * @returns {SongLine[]} - with added transposedModel property on each chord if needed\n */\nexport default function transposeSong(allLines, allChords, {\n\ttransposeValue = 0,\n\taccidentalsType = 'auto',\n\tharmonizeAccidentals = true\n} = {}) {\n\tlet transposed = _.cloneDeep(allLines);\n\n\tlet accidental = (accidentalsType === 'auto')\n\t\t? getMainAccidental(allChords)\n\t\t: accidentalsType;\n\n\tif (harmonizeAccidentals || transposeValue !== 0) {\n\t\ttransposed = forEachChordInSong(transposed, (chord) => {\n\t\t\tchord.transposedModel = transposeChord(\n\t\t\t\tchord.model,\n\t\t\t\ttransposeValue,\n\t\t\t\taccidental === 'flat'\n\t\t\t);\n\t\t});\n\t}\n\n\treturn transposed;\n}\n","/**\n * Returns the most used accidental of a song.\n *\n * @param {SongChord[]} allChords\n * @returns {('flat'|'sharp')}\n */\nexport default function getMainAccidental(allChords) {\n\tlet rootNote = '';\n\tlet flatCount = 0;\n\tlet sharpCount = 0;\n\n\tallChords.forEach(chord => {\n\t\trootNote = chord.model.symbol.rootNote;\n\n\t\tif (rootNote.length === 2) {\n\t\t\tlet accidental = rootNote[1];\n\n\t\t\tif (accidental === 'b') {\n\t\t\t\tflatCount += chord.occurrences;\n\t\t\t} else {\n\t\t\t\tsharpCount += chord.occurrences;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn (flatCount > sharpCount) ? 'flat' : 'sharp';\n}\n","import _ from 'lodash';\n\nexport default function isRenderer(renderer) {\n\treturn (_.isObject(renderer) && _.isFunction(renderer.render));\n}","import _ from 'lodash';\n\nimport isRenderer from '../isRenderer';\n\nimport barContentTpl from './barContent.hbs';\n\nconst space = ' ';\n\nconst defaultSpacesWithin = 0;\nconst defaultSpacesAfter = 2;\n\nexport default {\n\trender(bar, { chordRenderer } = {}) {\n\t\tlet spacesWithin = 0;\n\t\tlet spacesAfter = 0;\n\n\t\tif (! isRenderer(chordRenderer)) {\n\t\t\tthrow new TypeError('chordRenderer is not a valid renderer');\n\t\t}\n\n\t\tconst barContent = bar.allChords.reduce((rendering, chord) => {\n\t\t\tspacesWithin = _.isFinite(chord.spacesWithin) ? chord.spacesWithin : defaultSpacesWithin;\n\t\t\tspacesAfter = _.isFinite(chord.spacesAfter) ? chord.spacesAfter : defaultSpacesAfter;\n\n\t\t\trendering +=\n\t\t\t\tchordRenderer.render(chord.symbol) +\n\t\t\t\tspace.repeat(spacesWithin) +\n\t\t\t\tspace.repeat(spacesAfter);\n\n\t\t\treturn rendering;\n\t\t}, '');\n\n\t\treturn barContentTpl({ barContent });\n\t}\n};\n","import chordLineTpl from './chordLine.hbs';\nimport barSeparatorTpl from '../bar/barSeparator.hbs';\nimport isRenderer from '../isRenderer';\n\nexport default {\n\trender(chordLineModel, {\n\t\tbarContentRenderer,\n\t\tchordRenderer\n\t} = {}) {\n\n\t\tif (! isRenderer(barContentRenderer)) {\n\t\t\tthrow new TypeError('barContentRenderer is not a valid renderer');\n\t\t}\n\n\t\tconst allBarsRendered = chordLineModel.allBars\n\t\t\t.map(bar => barContentRenderer.render(bar, { chordRenderer }));\n\n\t\tconst barSeparator = barSeparatorTpl();\n\n\t\tconst chordLine = barSeparator +\n\t\t\tallBarsRendered.join(barSeparator) +\n\t\t\tbarSeparator;\n\n\t\treturn chordLineTpl({ chordLine });\n\t}\n};","import chordSymbolTpl from './chordSymbol.hbs';\n\nexport default {\n\trender(chordSymbol) {\n\t\treturn chordSymbolTpl({ chordSymbol });\n\t}\n};","import textLineTpl from './textLine.hbs';\n\nexport default {\n\trender(textLine) {\n\t\treturn textLineTpl({ textLine });\n\t}\n};","import { Chords } from 'momo-chords';\n\nconst chords = new Chords();\n\n/**\n * @param {ChordDef} chordDef\n * @returns {string}\n */\nexport default function(chordDef) {\n\treturn chords.print(chordDef.symbol);\n}","import parseSong from '../../parser/parseSong';\n\nimport getMaxBeatsWidth from '../getMaxBeatsWidth';\n\nimport simpleChordSpacer from '../spacer/chord/simple';\nimport alignedChordSpacer from '../spacer/chord/aligned';\n\nimport transposeSong from '../transposeSong';\nimport { forEachChordInSong } from '../helper/songs';\n\nimport barContentRenderer from '../bar/barContent';\nimport chordLineRenderer from '../chord/chordLine';\nimport chordSymbolRenderer from '../chord/chordSymbol';\nimport textLineRenderer from '../text/textLine';\n\nimport songTpl from './song.hbs';\nimport getChordSymbol from '../getChordSymbol';\n\n\nexport default {\n\trender(songTxt, {\n\t\talignBars = false,\n\t\ttransposeValue = 0,\n\t\taccidentalsType = 'auto',\n\t\tharmonizeAccidentals = true\n\t}) {\n\t\tconst parsedSong = parseSong(songTxt);\n\t\tlet { allLines, allChords } = parsedSong;\n\n\t\tallLines = transposeSong(allLines, allChords,  {\n\t\t\ttransposeValue,\n\t\t\taccidentalsType,\n\t\t\tharmonizeAccidentals\n\t\t});\n\t\tallLines = forEachChordInSong(allLines, (chord) => {\n\t\t\tchord.symbol = (chord.transposedModel)\n\t\t\t\t? getChordSymbol(chord.transposedModel)\n\t\t\t\t: getChordSymbol(chord.model);\n\t\t});\n\n\t\tconst maxBeatsWidth = getMaxBeatsWidth(allLines);\n\n\t\tconst song = allLines\n\t\t\t.map(line => {\n\n\t\t\t\tif (line.type === 'chord') {\n\t\t\t\t\tconst spaced = (alignBars)\n\t\t\t\t\t\t? alignedChordSpacer(line.model, maxBeatsWidth)\n\t\t\t\t\t\t: simpleChordSpacer(line.model);\n\n\t\t\t\t\tline.rendered = chordLineRenderer.render(spaced, {\n\t\t\t\t\t\tbarContentRenderer: barContentRenderer,\n\t\t\t\t\t\tchordRenderer: chordSymbolRenderer,\n\t\t\t\t\t});\n\n\t\t\t\t} else if (line.type === 'text') {\n\t\t\t\t\tline.rendered = textLineRenderer.render(line.string);\n\t\t\t\t}\n\t\t\t\treturn line;\n\t\t\t})\n\t\t\t.filter(line => line.rendered)\n\t\t\t.map(line => line.rendered)\n\t\t\t.join('\\n');\n\n\t\treturn songTpl({ song });\n\t}\n};\n","/**\n * @param {SongLine[]} allLines\n * @returns {Array}\n */\nexport default function getMaxBeatsWidth(allLines) {\n\tconst maxBeatsWidth = [];\n\n\tallLines\n\t\t.filter(line => line.type === 'chord')\n\t\t.forEach(line => {\n\t\t\tline.model.allBars.forEach((bar, barIndex) => {\n\t\t\t\tif (!maxBeatsWidth[barIndex]) {\n\t\t\t\t\tmaxBeatsWidth[barIndex] = {};\n\n\t\t\t\t\tfor (let i = 1; i <= bar.timeSignature.beatCount; i++) {\n\t\t\t\t\t\tmaxBeatsWidth[barIndex][i] = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbar.allChords.forEach(chord => {\n\t\t\t\t\tmaxBeatsWidth[barIndex][chord.beat] = Math.max(\n\t\t\t\t\t\tmaxBeatsWidth[barIndex][chord.beat],\n\t\t\t\t\t\tchord.symbol.length\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\treturn maxBeatsWidth;\n}\n","import parseSongLib from './parser/parseSong';\nimport editorFactoryLib from './editor/prosemirror/editor';\nimport songRendererFactory from './renderer/song/song';\n\nimport '../scss/ucc-editor.scss';\n\nexport const parseSong = parseSongLib;\nexport const editorFactory = editorFactoryLib;\nexport const songRenderer = songRendererFactory;\n","import { EditorState } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport { DOMParser as pmDOMParser } from 'prosemirror-model';\nimport getPlugins from './getPlugins';\nimport editorSchema from './schema';\n\nimport stateToArray from './helpers/stateToArray';\n\nimport { EventEmitter2 } from 'eventemitter2';\n\nimport 'prosemirror-view/style/prosemirror.css';\n\n\n/**\n * @param {Node} renderTo\n */\nexport default function editorFactory(renderTo) {\n\n\tconst editor = new EventEmitter2();\n\tconst editorPlugins = getPlugins(editor);\n\n\tlet editorView;\n\n\teditor.on('statechange', state => {\n\t\teditor.emit('change', stateToArray(state));\n\t});\n\n\treturn Object.assign(editor, {\n\t\tload(newContent) {\n\t\t\tconst newState = EditorState.create({\n\t\t\t\tdoc: pmDOMParser.fromSchema(editorSchema).parse(newContent),\n\t\t\t\tplugins: editorPlugins\n\t\t\t});\n\n\t\t\tif (editorView) {\n\t\t\t\teditorView.updateState(newState);\n\n\t\t\t} else {\n\t\t\t\teditorView = new EditorView(renderTo, { state: newState });\n\t\t\t}\n\t\t\teditor.emit('statechange', newState);\n\t\t},\n\n\t\tgetContent() {\n\t\t\treturn stateToArray(editorView.state);\n\t\t}\n\t});\n}\n","import { keymap } from 'prosemirror-keymap';\nimport { baseKeymap } from 'prosemirror-commands';\nimport { undo, redo, history as pmHistory } from 'prosemirror-history';\nimport onStateChange from './plugins/onStateChange';\n\nexport default function getPlugins(editor) {\n\treturn [\n\t\tpmHistory(),\n\t\tkeymap({ 'Mod-z': undo, 'Mod-y': redo }),\n\t\tkeymap(baseKeymap),\n\t\tonStateChange(editor)\n\t];\n}\n","import _ from 'lodash';\n\nimport pluginFactory from '../../core/plugin';\nimport htmlToElement from '../../../core/dom/htmlToElement';\n\nimport { editorFactory, songRenderer } from '@touffi/ucc/src/index-editor';\n\nimport editorTpl from './editor.hbs';\n\nconst editorPlugin = pluginFactory({\n\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst contentArea = areaBroker.getContent();\n\n\t\tconst editorDom = htmlToElement(editorTpl());\n\n\t\tcontentArea.appendChild(editorDom);\n\n\n\t\tconst renderingOptions = {\n\t\t\talignBars: true,\n\t\t\ttransposeValue: 0\n\t\t};\n\n\n\t\t// add editor functionality\n\t\tconst editorNode = document.querySelector('#source');\n\n\t\tconst editor = editorFactory(editorNode);\n\n\n\t\tconst previewContainer = document.querySelector('#preview');\n\n\t\tfunction previewSong(songLines) {\n\t\t\tconst renderedSong = songRenderer.render(songLines, renderingOptions);\n\t\t\tconst rendered = htmlToElement(renderedSong);\n\n\t\t\tif (previewContainer.childNodes.length) {\n\t\t\t\tpreviewContainer.replaceChild(rendered, previewContainer.firstChild);\n\t\t\t} else {\n\t\t\t\tpreviewContainer.appendChild(rendered);\n\t\t\t}\n\t\t}\n\n\t\tfunction refreshPreview() {\n\t\t\tconst songLines = editor.getContent();\n\t\t\tpreviewSong(songLines);\n\t\t}\n\n\t\teditor.on('change', (songLines) => {\n\t\t\tpreviewSong(songLines, renderingOptions);\n\t\t\tapp.emit('editorchange', songLines.join('\\n'));\n\t\t});\n\n\t\tapp.on('optionchange', newOptions => {\n\t\t\t_.assign(renderingOptions, newOptions);\n\t\t\trefreshPreview();\n\t\t});\n\n\t\tfunction toNode(text) {\n\t\t\tconst div = document.createElement('div');\n\t\t\tdiv.innerHTML = text\n\t\t\t\t.split('\\n')\n\t\t\t\t.map(line => `<p>${line}</p>`)\n\t\t\t\t.join('');\n\t\t\treturn div;\n\t\t}\n\n\t\t// listen to events\n\t\tapp.on('activatefile', file => editor.load(toNode(file.content)));\n\n\n\t}\n});\n\nexport default editorPlugin;\n","/**\n * Local storage wrapper\n * For now, the only accepted values are objects that are automatically serialized\n */\nconst store = {\n\tcreate(key, value) {\n\t\tif (localStorage.getItem(key)) {\n\t\t\tthrow new Error('Already exists key: ' + key);\n\t\t}\n\t\tif (!key) {\n\t\t\tthrow new Error('Cannot create localstorage entry with empty key');\n\t\t}\n\t\tlocalStorage.setItem(key, JSON.stringify(value));\n\t},\n\n\tgetOneByKey(key) {\n\t\tconst value = localStorage.getItem(key);\n\t\treturn (value) ? JSON.parse(value) : value;\n\t},\n\n\tgetAllByKeyPrefix(keyPrefix) {\n\t\tconst allEntries = {};\n\n\t\tlet key;\n\n\t\tfor (let i = 0; i < localStorage.length; i++) {\n\t\t\tkey = localStorage.key(i);\n\t\t\tif (key.indexOf(keyPrefix) === 0) {\n\t\t\t\tallEntries[key] = this.getOneByKey(key);\n\t\t\t}\n\t\t}\n\n\t\treturn allEntries;\n\t},\n\n\tupdate(key, value) {\n\t\tif (!localStorage.getItem(key)) {\n\t\t\tthrow new Error('Cannot find and update key: ' + key);\n\t\t}\n\t\tlocalStorage.setItem(key, JSON.stringify(value));\n\t},\n\n\tdelete(key) {\n\t\tlocalStorage.removeItem(key);\n\t}\n};\n\nexport default store;","import nanoid from 'nanoid';\nimport EventEmitter from 'eventemitter2';\n\nimport store from '../../core/store';\n\nconst keyPrefix = 'song:';\n\nfunction fileFactory() {\n\treturn {\n\t\tkey: keyPrefix + nanoid(20),\n\t\ttitle: 'untitled', //todo: translate!\n\t\tcontent: ''\n\t};\n}\n\nexport default function fileExplorerFactory() {\n\tconst fileManager = new EventEmitter();\n\n\treturn Object.assign(fileManager, {\n\t\tcreate() {\n\t\t\tconst newFile = fileFactory();\n\n\t\t\tstore.create(newFile.key, newFile);\n\n\t\t\treturn newFile;\n\t\t},\n\n\t\tgetAll() {\n\t\t\treturn store.getAllByKeyPrefix(keyPrefix);\n\t\t},\n\n\t\tgetOneByKey(key) {\n\t\t\treturn store.getOneByKey(key);\n\t\t},\n\n\t\tupdateContent(key, content) {\n\t\t\tconst file = store.getOneByKey(key);\n\t\t\tfile.content = content;\n\n\t\t\tstore.update(key, file);\n\t\t},\n\n\t\tupdateTitle(key, title) {\n\t\t\tconst file = store.getOneByKey(key);\n\t\t\tfile.title = title;\n\n\t\t\tstore.update(key, file);\n\t\t},\n\n\t\tdeleteOne(key) {\n\t\t\tstore.delete(key);\n\t\t}\n\t});\n}","import _ from 'lodash';\n\nimport pluginFactory from '../../../app/core/plugin';\nimport htmlToElement from '../../../core/dom/htmlToElement';\n\nimport fileManagerFactory from './fileManager';\n\nimport fileExplorerTpl from './fileExplorer.hbs';\nimport fileEntryTpl from './entry.hbs';\n\n\nconst autosaveIntervalMs = 1000;\n\nconst fileExplorerPlugin = pluginFactory({\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst sideBar = areaBroker.getSideBar();\n\n\t\tconst fileExplorer = new DocumentFragment();\n\t\tfileExplorer.appendChild(htmlToElement(fileExplorerTpl()));\n\n\n\t\tlet activeFileKey;\n\n\t\t// DOM elements\n\t\tconst newFileBtn = fileExplorer.querySelector('[data-action=\"new-file\"]');\n\t\tconst deleteFileBtn = fileExplorer.querySelector('[data-action=\"delete-file\"]');\n\t\tconst fileList = fileExplorer.querySelector('.entry-list');\n\n\n\t\tfunction insertFile(file) {\n\t\t\tconst newEntry = htmlToElement(fileEntryTpl(file));\n\n\t\t\tconst activeFile = fileList.querySelector(`[data-key=\"${activeFileKey}\"`);\n\n\t\t\tif (activeFile && activeFile.nextSibling) {\n\t\t\t\tfileList.insertBefore(newEntry, activeFile.nextSibling);\n\n\t\t\t} else {\n\t\t\t\tfileList.appendChild(newEntry);\n\t\t\t}\n\t\t\treturn newEntry;\n\t\t}\n\n\t\tconst activateFile = (key) => {\n\t\t\tactiveFileKey = key;\n\n\t\t\tfileList.querySelectorAll('.active').forEach(active => active.classList.remove('active'));\n\t\t\tconst activeFile = fileList.querySelector(`[data-key=\"${key}\"`);\n\t\t\tif (activeFile) {\n\t\t\t\tactiveFile.classList.add('active');\n\t\t\t}\n\n\t\t\tconst file = this.fm.getOneByKey(activeFileKey);\n\t\t\tapp.emit('activatefile', file);\n\t\t};\n\n\t\t// load existing files\n\t\tconst allFiles = this.fm.getAll();\n\t\tconst sortedFiles = _.sortBy(allFiles, o => o.title);\n\n\t\tif (sortedFiles.length) {\n\t\t\tsortedFiles.forEach( file => {\n\t\t\t\tinsertFile(file);\n\t\t\t});\n\t\t\tactivateFile(sortedFiles[0].key);\n\t\t}\n\n\n\n\t\t// Add behaviour events\n\t\tconst createNewFile = () => {\n\t\t\tconst newFile = this.fm.create();\n\n\t\t\tconst newFileElement = insertFile(newFile);\n\t\t\tactivateFile(newFile.key);\n\n\t\t\t_.defer(() => makeTitleEditable(newFileElement));\n\t\t};\n\n\t\tconst deleteFile = () => {\n\t\t\tthis.fm.deleteOne(activeFileKey);\n\n\t\t\tconst toDelete = fileList.querySelector(`[data-key=\"${activeFileKey}\"]`);\n\n\t\t\tif (toDelete) {\n\t\t\t\tconst toActivate = (toDelete.previousSibling)\n\t\t\t\t\t? toDelete.previousSibling\n\t\t\t\t\t: toDelete.nextSibling;\n\n\t\t\t\tfileList.removeChild(toDelete);\n\n\t\t\t\tif (toActivate) {\n\t\t\t\t\tactivateFile(toActivate.dataset.key);\n\n\t\t\t\t} else {\n\t\t\t\t\tactiveFileKey = null;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// todo: don't pass around event object\n\t\tconst preventEnterKey = e => {\n\t\t\tif (e.which === 13) {\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t};\n\n\t\tconst blurOnEnter = e => {\n\t\t\tif (e.which === 13 && e.target.contentEditable) {\n\t\t\t\te.target.blur();\n\t\t\t\te.target.contentEditable = false;\n\t\t\t}\n\t\t};\n\n\t\tconst activateEntry = e => {\n\t\t\tif (e.detail === 1) {\n\t\t\t\tconst keyElement = e.target.closest('[data-key]');\n\t\t\t\tactivateFile(keyElement.dataset.key);\n\t\t\t}\n\t\t};\n\n\t\tconst makeTitleEditable = entry => {\n\t\t\tconst title = entry.querySelector('.entry-title');\n\t\t\ttitle.contentEditable = true;\n\t\t\ttitle.focus();\n\n\t\t\tconst range = new Range();\n\t\t\trange.selectNodeContents(title);\n\t\t\tconst selection = window.getSelection();\n\t\t\tselection.removeAllRanges();\n\t\t\tselection.addRange(range);\n\t\t};\n\n\t\tconst autosaveTitle = e => {\n\t\t\tconst keyElement = e.target.closest('[data-key]');\n\t\t\tthis.fm.updateTitle(keyElement.dataset.key, e.target.innerText); //todo sanitize\n\t\t\t//todo prevent empty\n\t\t};\n\n\t\tconst autoBlurContentEditableElements = e => {\n\t\t\tconst allEditable = fileList.querySelectorAll('[contenteditable=\"true\"]');\n\t\t\tallEditable.forEach(editable => {\n\t\t\t\tif (!editable.isSameNode(e.target)) {\n\t\t\t\t\teditable.contentEditable = false;\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\twindow.addEventListener('click', autoBlurContentEditableElements);\n\n\t\tnewFileBtn.addEventListener('click', createNewFile);\n\t\tdeleteFileBtn.addEventListener('click', deleteFile);\n\n\t\tfileList.addEventListener('keypress', preventEnterKey);\n\t\tfileList.addEventListener('keypress', blurOnEnter);\n\t\tfileList.addEventListener('input', _.throttle(autosaveTitle, autosaveIntervalMs));\n\t\tfileList.addEventListener('click', activateEntry);\n\t\tfileList.addEventListener('dblclick', e => makeTitleEditable(e.target.parentElement)); //todo fix bug when click outside of title div\n\n\t\tapp.on('editorchange', fileContent => {\n\t\t\tthis.fm.updateContent(activeFileKey, fileContent);\n\t\t});\n\n\t\t// attach to document\n\t\tsideBar.appendChild(fileExplorer);\n\t},\n\n\tinit() {\n\t\tthis.fm = fileManagerFactory();\n\t}\n});\n\nexport default fileExplorerPlugin;\n\n\n\n/**\n // Drag & drop\n const body = document.body;\n body.ondragover = () => {\n\tbody.classList.add('hover');\n\treturn false;\n};\n body.ondragleave = () => {\n\tbody.classList.remove('hover');\n\treturn false;\n};\n\n body.ondrop = e => {\n\tbody.classList.remove('hover');\n\te.preventDefault();\n\n\tconst file = e.dataTransfer.files[0];\n\tconst reader = new FileReader();\n\n\treader.onload = function(event) {\n\t\teditor.load(toNode(event.target.result));\n\t};\n\treader.readAsText(file);\n\n\treturn false;\n};\n **/","import pluginFactory from '../../../app/core/plugin';\nimport htmlToElement from '../../../core/dom/htmlToElement';\n\nimport renderingOptionsTpl from './renderingOptions.hbs';\n\nconst renderingOptionsPlugin = pluginFactory({\n\trender() {\n\t\tconst app = this.getHost();\n\t\tconst areaBroker = app.getAreaBroker();\n\t\tconst header = areaBroker.getHeader();\n\n\t\tconst renderingOptions = new DocumentFragment();\n\t\trenderingOptions.appendChild(htmlToElement(renderingOptionsTpl()));\n\n\n\t\t// align bars\n\t\tconst alignBars = renderingOptions.querySelector('[data-option=\"align-bars\"]');\n\t\talignBars.addEventListener('change', e => {\n\t\t\tapp.emit('optionchange', {\n\t\t\t\talignBars: e.target.checked\n\t\t\t});\n\t\t});\n\n\n\t\t// transpose\n\t\tconst transposeDown = renderingOptions.querySelector('[data-option=\"transpose-down\"]');\n\t\tconst transposeUp = renderingOptions.querySelector('[data-option=\"transpose-up\"]');\n\t\tconst transposeValue = renderingOptions.querySelector('[data-option=\"transpose-value\"]');\n\n\t\ttransposeDown.addEventListener('click', () => transpose(-1));\n\t\ttransposeUp.addEventListener('click', () => transpose(1));\n\n\t\tfunction transpose(step) {\n\t\t\tconst currentTransposeValue = Number.parseInt(transposeValue.innerText);\n\t\t\tconst newTransposeValue = currentTransposeValue + step;\n\t\t\tapp.emit('optionchange', {\n\t\t\t\ttransposeValue: newTransposeValue\n\t\t\t});\n\t\t\ttransposeValue.innerText = (newTransposeValue) > 0 ?'+' + newTransposeValue : newTransposeValue;\n\t\t}\n\n\n\t\t// Harmonize accidentals\n\t\tconst harmonizeAccidentals = renderingOptions.querySelector('[data-option=\"harmonize-accidentals\"]');\n\t\tharmonizeAccidentals.addEventListener('change', () => {\n\t\t\tconst checked = harmonizeAccidentals.querySelector('input[name=\"ha\"]:checked');\n\t\t\tapp.emit('optionchange', {\n\t\t\t\tharmonizeAccidentals: (checked.value === 'true')\n\t\t\t});\n\t\t});\n\n\t\t// accidentals type\n\t\tconst accidentalsType = renderingOptions.querySelector('[data-option=\"accidentals-type\"]');\n\t\taccidentalsType.addEventListener('change', () => {\n\t\t\tconst checked = accidentalsType.querySelector('input[name=\"ht\"]:checked');\n\t\t\tapp.emit('optionchange', {\n\t\t\t\taccidentalsType: checked.value\n\t\t\t});\n\t\t});\n\n\n\t\t// app.on('optionchange', console.log);\n\n\t\t// attach to document\n\t\theader.appendChild(renderingOptions);\n\t}\n});\n\nexport default renderingOptionsPlugin;\n\n","import '../../scss/styles.scss';\n\nimport areaBrokerFactory from './core/areaBroker';\nimport appFactory from './core/app';\nimport registerPlugins from './registerPlugins';\n\nconst areas = {\n\theader: '[data-area=\"app-header\"]',\n\tfooter: '[data-area=\"app-footer\"]',\n\tsideBar: '[data-area=\"app-side-bar\"]',\n\tcontent: '[data-area=\"app-content\"]',\n};\n\nconst areaBroker = areaBrokerFactory(areas);\nconst app = appFactory(areaBroker);\n\nregisterPlugins(app);\n\napp.init()\n\t.then(() => {\n\t\treturn app.render();\n\t});\n\n\n\n/**\nconst alignRenderingSwitch = document.querySelector('#aligned-rendering');\n\nalignRenderingSwitch.addEventListener('change', () => {\n\teditor.load(editorNode);\n});\n**/\n","import _ from 'lodash';\nimport EventEmitter from 'eventemitter2';\n\nexport default function appFactory(areaBroker) {\n\tconst pluginRegistry = [];\n\n\tconst app = new EventEmitter();\n\n\tasync function pluginRun(method) {\n\t\tlet plugin;\n\n\t\tfor (let i = 0; i < pluginRegistry.length; i++) {\n\t\t\tplugin = pluginRegistry[i];\n\n\t\t\tif (_.isFunction(plugin[method])) {\n\t\t\t\tawait plugin[method]();\n\t\t\t}\n\t\t}\n\t\tthis.emit(method);\n\t}\n\n\treturn Object.assign(app, {\n\t\tgetAreaBroker() {\n\t\t\treturn areaBroker;\n\t\t},\n\n\t\tregisterPlugin(plugin) {\n\t\t\tplugin.setHost(this);\n\t\t\tpluginRegistry.push(plugin);\n\t\t},\n\n\t\tinit() {\n\t\t\treturn pluginRun.call(this, 'init');\n\t\t},\n\n\t\trender() {\n\t\t\treturn pluginRun.call(this, 'render');\n\t\t}\n\t});\n}","import _ from 'lodash';\n\n/**\n * @param areas - key/value pairs where key = areaId and value = cssSelector\n */\nexport default function areaBrokerFactory(areas) {\n\n\tconst areaBroker = {};\n\n\tlet getterName;\n\n\t_.forEach(areas,  (cssSelector, areaId) => {\n\t\tgetterName = 'get' + areaId.charAt(0).toUpperCase() + areaId.slice(1);\n\n\t\tareaBroker[getterName] = () => {\n\t\t\tconst area = document.querySelectorAll(cssSelector);\n\n\t\t\tif (area.length === 0) {\n\t\t\t\tthrow new Error('Cannot find area: ' + areaId + ' with selector: ' + cssSelector);\n\n\t\t\t} else if (area.length > 1) {\n\t\t\t\tthrow new Error('Multiple areas: ' + areaId + ' found with selector: ' + cssSelector);\n\t\t\t}\n\t\t\treturn area.item(0);\n\t\t};\n\t});\n\n\treturn areaBroker;\n}","import header from './plugins/content/header/plugin';\nimport footer from './plugins/content/footer/plugin';\nimport editor from './plugins/editor/plugin';\nimport fileExplorer from './plugins/fileExplorer/plugin';\nimport renderingOptions from './plugins/renderingOptions/plugin';\n\nexport default function registerPlugins(app) {\n\tapp.registerPlugin(header);\n\tapp.registerPlugin(footer);\n\tapp.registerPlugin(editor);\n\tapp.registerPlugin(fileExplorer);\n\tapp.registerPlugin(renderingOptions);\n}","var Handlebars = require(\"../../../../ucc-demo/node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<span class=\\\"cp2-bar-separator\\\">|</span>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../ucc-demo/node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<span class=\\\"cp2-bar-content\\\">\"\n    + ((stack1 = container.lambda((depth0 != null ? depth0.barContent : depth0), depth0)) != null ? stack1 : \"\")\n    + \"</span>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../ucc-demo/node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1;\n\n  return \"<p class=\\\"cp2-chord-line\\\">\"\n    + ((stack1 = container.lambda((depth0 != null ? depth0.chordLine : depth0), depth0)) != null ? stack1 : \"\")\n    + \"</p>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"rendering-options\\\">\\n    <div class=\\\"panel\\\">\\n        <input type=\\\"checkbox\\\" id=\\\"align-bars\\\" data-option=\\\"align-bars\\\" checked><label for=\\\"align-bars\\\">Align bars</label><br />\\n    </div>\\n    <div class=\\\"panel\\\">\\n        Transpose: <button data-option=\\\"transpose-down\\\">-1</button> <span data-option=\\\"transpose-value\\\">0</span> <button data-option=\\\"transpose-up\\\">+1</button><br />\\n        <div data-option=\\\"harmonize-accidentals\\\">\\n            Unify flats / sharps\\n            <input type=\\\"radio\\\" id=\\\"harmonize-accidentals-false\\\" name=\\\"ha\\\" value=\\\"false\\\"><label for=\\\"harmonize-accidentals-false\\\">No</label>\\n            <input type=\\\"radio\\\" id=\\\"harmonize-accidentals-true\\\" name=\\\"ha\\\" value=\\\"true\\\" checked><label for=\\\"harmonize-accidentals-true\\\">Yes</label><br/>\\n        </div>\\n        <div data-option=\\\"accidentals-type\\\">\\n            Accidentals\\n            <input type=\\\"radio\\\" id=\\\"accidentals-type-auto\\\" name=\\\"ht\\\" value=\\\"auto\\\" checked><label for=\\\"accidentals-type-auto\\\">Auto</label>\\n            <input type=\\\"radio\\\" id=\\\"accidentals-type-flat\\\" name=\\\"ht\\\" value=\\\"flat\\\"><label for=\\\"accidentals-type-flat\\\">Flat</label>\\n            <input type=\\\"radio\\\" id=\\\"accidentals-type-sharp\\\" name=\\\"ht\\\" value=\\\"sharp\\\"><label for=\\\"accidentals-type-sharp\\\">Sharp</label>\\n        </div>\\n    </div>\\n</div>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"app-footer\\\">\\n    Universal Chord Charts v0.4.0\\n</div>\\n\";\n},\"useData\":true});","var Handlebars = require(\"../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=\"function\", alias4=container.escapeExpression;\n\n  return \"<li class=\\\"entry\\\" data-key=\\\"\"\n    + alias4(((helper = (helper = helpers.key || (depth0 != null ? depth0.key : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"key\",\"hash\":{},\"data\":data}) : helper)))\n    + \"\\\">\\n    <div class=\\\"entry-title\\\">\"\n    + alias4(((helper = (helper = helpers.title || (depth0 != null ? depth0.title : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"title\",\"hash\":{},\"data\":data}) : helper)))\n    + \"</div>\\n</li>\";\n},\"useData\":true});","var Handlebars = require(\"../../../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[7,\">= 4.0.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div class=\\\"file-explorer\\\">\\n    <div class=\\\"file-explorer-actions\\\">\\n        <button data-action=\\\"new-file\\\">New file</button>\\n        <button data-action=\\\"delete-file\\\">Delete</button>\\n    </div>\\n    <hr />\\n    <ul class=\\\"entry-list\\\"></ul>\\n</div>\";\n},\"useData\":true});"],"sourceRoot":""}